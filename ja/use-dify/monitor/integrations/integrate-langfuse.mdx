---
title: Langfuseの統合
---

<Note> ⚠️ このドキュメントはAIによって自動翻訳されています。不正確な部分がある場合は、[英語版](/en/use-dify/monitor/integrations/integrate-langfuse)を参照してください。</Note>

### Langfuseとは

Langfuseは、チームがアプリケーションのデバッグ、分析、反復作業を協力して行うことができる、オープンソースの大規模言語モデル（LLM）エンジニアリングプラットフォームです。

<Info>
  Langfuseの紹介: [https://langfuse.com/](https://langfuse.com/)
</Info>

***

### Langfuseの設定方法

1. [公式ウェブサイト](https://langfuse.com/)でLangfuseに登録し、ログインします。
2. Langfuseでプロジェクトを作成します。ログイン後、ホームページで**新規**をクリックして自身のプロジェクトを作成します。この**プロジェクト**は、Difyの**アプリケーション**と関連付けてデータを監視するために使用されます。

![](https://assets-docs.dify.ai/2025/04/34ca6a973c4a1230be659b313b99fd90.png)

プロジェクトの名前を編集してください。

![Create a project in Langfuse](https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/monitoring/integrate-external-ops-tools/26cfbb94e312a100c39e217fdd0b4406.png)

3. プロジェクトAPI資格情報を作成します。プロジェクトの左サイドバーで**設定**をクリックし、設定を開きます。

![Create project API credentials](https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/monitoring/integrate-external-ops-tools/2ed72a6761f2977201c29e67e5bc634c.png)

設定で**APIキーを作成**をクリックして、プロジェクトのAPI資格情報を作成します。

![Create project API credentials](https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/monitoring/integrate-external-ops-tools/3c3fbd5392d37fbccf1f9ef76c54f0bc.png)

**シークレットキー**、**パブリックキー**、**ホスト**をコピーして保存します。

![Get API Key configuration](https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/monitoring/integrate-external-ops-tools/a2ff67951ce300082d875eae8458c8c7.png)

4. DifyでLangfuseを設定します。監視が必要なアプリケーションを開き、サイドメニューで**モニタリング**を開き、ページ上で**アプリパフォーマンスのトレース**を選択します。

![Configure Langfuse](https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/monitoring/integrate-external-ops-tools/ebc84b328ad37c0f6dbca6101e1f90ab.png)

設定をクリックした後、Langfuseで作成した**シークレットキー、パブリックキー、ホスト**を構成に貼り付けて保存します。

![Configure Langfuse](https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/monitoring/integrate-external-ops-tools/5bfa409e7a073f133f21146535401512.png)

正常に保存されると、現在のページで状態を確認できます。開始と表示されている場合、監視が行われています。

![View configuration status](https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/monitoring/integrate-external-ops-tools/1aa086a1aead0e29948e7d6d5815d5d1.png)

***

### Langfuseでの監視データの閲覧

設定後、DifyのアプリケーションのデバッグまたはプロダクションデータをLangfuseで見ることができます。

![](https://assets-docs.dify.ai/2025/04/a2c02ccc559743b85b0f972aa513e47a.png)

![](https://assets-docs.dify.ai/2025/04/88f3adfb03f325d2ea800ba5685b9ec9.png)

***

### 監視データの一覧

#### ワークフローとチャットフローの情報をトレースする

**ワークフローとチャットフローのトレース**

<table>
  <thead>
    <tr>
      <th>ワークフロー</th>
      <th>LangFuse Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>workflow\_app\_log\_id/workflow\_run\_id</td>
      <td>id</td>
    </tr>
    <tr>
      <td>user\_session\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>workflow\_{id}</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>モデルトークン消費量</td>
      <td>usage</td>
    </tr>
    <tr>
      <td>元データ</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>error</td>
      <td>level</td>
    </tr>
    <tr>
      <td>error</td>
      <td>status\_message</td>
    </tr>
    <tr>
      <td>\[workflow]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>\["message", conversation\_mode]</td>
      <td>session\_id</td>
    </tr>
    <tr>
      <td>conversion\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**ワークフロートレース情報**

* workflow\_id - ワークフローのユニークID
* conversation\_id - 会話ID
* workflow\_run\_id - このランタイムのワークフローID
* tenant\_id - テナントID
* elapsed\_time - このランタイムの経過時間
* status - ランタイムのステータス
* version - ワークフローのバージョン
* total\_tokens - このランタイムで使用されたトークンの総数
* file\_list - 処理されたファイルのリスト
* triggered\_from - このランタイムをトリガーしたソース
* workflow\_run\_inputs - このワークフローの入力
* workflow\_run\_outputs - このワークフローの出力
* error - エラーメッセージ
* query - ランタイムで使用されたクエリ
* workflow\_app\_log\_id - ワークフローアプリケーションログID
* message\_id - 関連するメッセージID
* start\_time - このランタイムの開始時間
* end\_time - このランタイムの終了時間
* ワークフローノード実行 - ワークフローノードのランタイム情報
* 元データ（Metadata）
  * workflow\_id - ワークフローのユニークID
  * conversation\_id - 会話ID
  * workflow\_run\_id - このランタイムのワークフローID
  * tenant\_id - テナントID
  * elapsed\_time - このランタイムの経過時間
  * status - オペレーション状態
  * version - ワークフローのバージョン
  * total\_tokens - このランタイムで使用されたトークンの総数
  * file\_list - 処理されたファイルのリスト
  * triggered\_from - このランタイムをトリガーしたソース

#### メッセージトレース情報

**LLM会話をトレースするために**

<table>
  <thead>
    <tr>
      <th>メッセージ</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>message\_id</td>
      <td>id</td>
    </tr>
    <tr>
      <td>user\_session\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>message\_{id}</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>モデルトークン消費量</td>
      <td>usage</td>
    </tr>
    <tr>
      <td>元データ</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>error</td>
      <td>level</td>
    </tr>
    <tr>
      <td>error</td>
      <td>status\_message</td>
    </tr>
    <tr>
      <td>\["message", conversation\_mode]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>conversation\_id</td>
      <td>session\_id</td>
    </tr>
    <tr>
      <td>conversion\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**メッセージトレース情報**

* message\_id - メッセージID
* message\_data - メッセージデータ
* user\_session\_id - ユーザーのセッションID
* conversation\_model - 会話モデル
* message\_tokens - メッセージトークン
* answer\_tokens - 回答トークン
* total\_tokens - メッセージと回答からの総トークン
* error - エラーメッセージ
* inputs - 入力データ
* outputs - 出力データ
* file\_list - 処理されたファイルのリスト
* start\_time - 開始時間
* end\_time - 終了時間
* message\_file\_data - 関連するファイルデータのメッセージ
* conversation\_mode - 会話モード
* 元データ（Metadata）
  * conversation\_id - 会話ID
  * ls\_provider - モデルプロバイダー
  * ls\_model\_name - モデルID
  * status - メッセージのステータス
  * from\_end\_user\_id - 送信ユーザーのID
  * from\_account\_id - 送信アカウントのID
  * agent\_based - エージェントベースかどうか
  * workflow\_run\_id - このランタイムのワークフローID
  * from\_source - メッセージソース

#### モデレーショントレース情報

**会話のモデレーションを追跡するために使用されます**

<table>
  <thead>
    <tr>
      <th>モデレーション</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>moderation</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>元データ</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\[moderation]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>message\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**メッセージトレース情報**

* message\_id - メッセージID
* user\_id - ユーザーID
* workflow\_app\_log\_id workflow\_app\_log\_id
* inputs - レビューのための入力データ
* message\_data - メッセージデータ
* flagged - 注目のためにフラグが立てられているかどうか
* action - 実施すべき具体的なアクション
* preset\_response - プリセット応答
* start\_time - レビューの開始時間
* end\_time - レビューの終了時間
* 元データ（Metadata）
  * message\_id - メッセージID
  * action - 実施すべき具体的なアクション
  * preset\_response - プリセット応答

#### 推奨質問のトレース情報

**推奨質問を追跡するために使用されます**

<table>
  <thead>
    <tr>
      <th>推奨質問</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>suggested\_question</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>元データ</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\[suggested\_question]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>message\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**メッセージトレース情報**

* message\_id - メッセージID
* message\_data - メッセージデータ
* inputs - 入力データ
* outputs - 出力データ
* start\_time - 開始時間
* end\_time - 終了時間
* total\_tokens - 総トークン数
* status - メッセージのステータス
* error - エラーメッセージ
* from\_account\_id - 送信アカウントID
* agent\_based - エージェントベースかどうか
* from\_source - メッセージソース
* model\_provider - モデルプロバイダー
* model\_id - モデルID
* suggested\_question - 推奨質問
* level - ステータスレベル
* status\_message - メッセージステータス
* 元データ（Metadata）
  * message\_id - メッセージID
  * ls\_provider - モデルプロバイダー
  * ls\_model\_name - モデルID
  * status - メッセージのステータス
  * from\_end\_user\_id - 送信ユーザーのID
  * from\_account\_id - 送信アカウントID
  * workflow\_run\_id - このランタイムのワークフローID
  * from\_source - メッセージソース

#### データセットリトリーバルトレース情報

**知識ベースの検索を追跡するために使用されます**

<table>
  <thead>
    <tr>
      <th>データセットリトリーバル</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>dataset\_retrieval</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>元データ</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\[dataset\_retrieval]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>message\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**データセットリトリーバルトレース情報**

* message\_id - メッセージID
* inputs - 入力メッセージ
* documents - ドキュメントデータ
* start\_time - 開始時間
* end\_time - 終了時間
* message\_data - メッセージデータ
* 元データ（Metadata）
  * message\_id - メッセージID
  * ls\_provider - モデルプロバイダー
  * ls\_model\_name - モデルID
  * status - モデルのステータス
  * from\_end\_user\_id - 送信ユーザーのID
  * from\_account\_id - 送信アカウントのID
  * agent\_based - エージェントベースかどうか
  * workflow\_run\_id - このランタイムのワークフローID
  * from\_source - メッセージソース

#### ツールトレース情報

**ツール呼び出しを追跡するために使用されます**

<table>
  <thead>
    <tr>
      <th>ツール</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>tool\_name</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>元データ</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\["tool", tool\_name]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>message\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**ツールトレース情報**

* message\_id - メッセージID
* tool\_name - ツール名
* start\_time - 開始時間
* end\_time - 終了時間
* tool\_inputs - ツール入力
* tool\_outputs - ツール出力
* message\_data - メッセージデータ
* error - エラーメッセージが存在する場合
* inputs - メッセージの入力
* outputs - メッセージの出力
* tool\_config - ツール構成
* time\_cost - 時間コスト
* tool\_parameters - ツールパラメータ
* file\_url - 関連ファイルのURL
* 元データ（Metadata）
  * message\_id - メッセージID
  * tool\_name - ツール名
  * tool\_inputs - ツール入力
  * tool\_outputs - ツール出力
  * tool\_config - ツール構成
  * time\_cost - 時間コスト
  * error - エラーメッセージ
  * tool\_parameters - ツールパラメータ
  * message\_file\_id - メッセージファイルID
  * created\_by\_role - 作成者の役割
  * created\_user\_id - 作成したユーザーID

#### 名前生成トレース

**会話タイトルの生成を追跡するために使用されます**

<table>
  <thead>
    <tr>
      <th>名前生成</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>generate\_name</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>元データ</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\[generate\_name]</td>
      <td>tags</td>
    </tr>
  </tbody>
</table>
**名前生成トレース情報**

* conversation\_id - 会話ID
* inputs - 入力データ
* outputs - 生成されたセッション名
* start\_time - 開始時間
* end\_time - 終了時間
* tenant\_id - テナントID
* 元データ（Metadata）
  * conversation\_id - 会話ID
  * tenant\_id - テナントID

### Langfuseプロンプト管理

[Langfuseプロンプト管理プラグイン](https://github.com/gao-ai-com/dify-plugin-langfuse)（コミュニティによって維持されている）は、Difyアプリケーションで[Langfuseで管理およびバージョン管理されているプロンプト](https://langfuse.com/docs/prompts/get-started)を使用できるようにし、大規模言語モデル（LLM）アプリケーション開発のワークフローを向上させます。主な機能は以下の通りです：

- **プロンプトを取得する:** Langfuseで管理されている特定のプロンプトを取得します。
- **プロンプトを検索する:** Langfuseでさまざまなフィルターを使用してプロンプトを検索します。
- **プロンプトを更新する:** Langfuseでプロンプトの新しいバージョンを作成し、タグ/ラベルを設定します。

この統合により、プロンプトの管理およびバージョン管理のプロセスが合理化され、より効率的な開発と反復サイクルに寄与します。プラグインとインストール手順は[こちら](https://github.com/gao-ai-com/dify-plugin-langfuse)で見つけることができます。
