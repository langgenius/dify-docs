---
title: チャンク設定
---

<Note> ⚠️ このドキュメントはAIによって自動翻訳されています。不正確な部分がある場合は、[英語版](/en/use-dify/knowledge/create-knowledge/chunking-and-cleaning-text)を参照してください。</Note>

## チャンクとは？

ナレッジベースにインポートされたドキュメントは、**チャンク**と呼ばれる小さなセグメントに分割されます。チャンク化は、大きな本を章や段落に整理するようなものです。一つの巨大なテキストブロックから特定の情報を素早く見つけることはできませんが、よく整理されたセクションがあれば、検索は効率的になります。

ユーザーが質問すると、システムはこれらのチャンクから関連情報を検索し、LLMにコンテキストとして提供します。チャンク化がなければ、すべてのクエリに対してドキュメント全体を処理することになり、遅く非効率的です。

**主要なチャンクパラメータ**

- **区切り文字**：テキストを分割する文字またはシーケンス。例えば、`\n\n`は段落区切りで分割し、`\n`は改行で分割します。

  <Note>
    区切り文字はチャンク化の際に削除されます。例えば、`A`を区切り文字として使用すると、`CBACD`は`CB`と`CD`に分割されます。
    
    情報の損失を避けるため、ドキュメント内に自然に出現しない非コンテンツ文字を使用してください。
  </Note>

- **最大チャンク長**：各チャンクの最大文字数。この制限を超えるテキストは、区切り文字の設定に関係なく強制的に分割されます。

## チャンクモードの選択

<Note>
    チャンクモードはナレッジベース作成後に変更できません。ただし、区切り文字や最大チャンク長などのチャンク設定はいつでも調整できます。
</Note>

### モードの概要

<Tabs>
  <Tab title="汎用">

    汎用モードでは、すべてのチャンクが同じ設定を共有します。マッチしたチャンクは検索結果として直接返されます。

    **チャンク設定**

    区切り文字と最大チャンク長に加えて、**チャンクのオーバーラップ**を設定して、隣接するチャンク間で重複する文字数を指定できます。これにより、意味的なつながりを保持し、重要な情報がチャンク境界で分割されることを防ぎます。

    例えば、50文字のオーバーラップでは、あるチャンクの最後の50文字が次のチャンクの最初の50文字としても表示されます。
    
  </Tab>
    <Tab title="親子">

      親子モードでは、テキストは2つの階層に分割されます：小さな**子チャンク**と大きな**親チャンク**。クエリが子チャンクにマッチすると、その親チャンク全体が検索結果として返されます。

      これは一般的な検索のジレンマを解決します：小さなチャンクは正確なクエリマッチングを可能にしますがコンテキストが不足し、大きなチャンクは豊富なコンテキストを提供しますが検索精度が低下します。

      親子モードは両方のバランスを取ります—精度で検索し、コンテキストで応答します。

      **親チャンク設定**

      親チャンクは**段落**または**全文**モードで作成できます。

      <Tabs>
        <Tab title="段落">
          ドキュメントは指定された区切り文字と最大チャンク長に基づいて複数の親チャンクに分割されます。

          セクションが明確に構造化された長いドキュメントで、各セクションが独立して意味のあるコンテキストを提供する場合に適しています。
        </Tab>
        <Tab title="全文">
          ドキュメント全体が単一の親チャンクとして扱われます。

          小さく一貫性のあるドキュメントで、特定の詳細を理解するために全体のコンテキストが不可欠な場合に適しています。

          <Note>
            **全文**モードでは：

            - 最初の10,000トークンのみが処理されます。この制限を超えるコンテンツは切り捨てられます。

            - 親チャンクは作成後に編集できません。変更するには、新しいドキュメントをアップロードする必要があります。

          </Note>
        </Tab>
      </Tabs>

      **子チャンク設定**

      各親チャンクは、独自の区切り文字と最大チャンク長設定を使用して、さらに子チャンクに分割されます。

    </Tab>
</Tabs>

### クイック比較

| 項目 | 汎用モード | 親子モード |
|:----------|:-------------|:------------------|
| チャンク戦略 | 単層：すべてのチャンクが同じ設定を使用 | 二層：親チャンクと子チャンクで別々の設定 |
| 検索ワークフロー | マッチしたチャンクが直接返される | 子チャンクはクエリのマッチングに使用され、親チャンクがより広いコンテキストを提供するために返される |
| 対応[インデックス方式](/ja/use-dify/knowledge/create-knowledge/setting-indexing-methods) | 高品質、経済的 | 高品質のみ |
| 最適な用途 | 用語集やFAQのようなシンプルで自己完結したコンテンツ | 技術マニュアルや研究論文のようなコンテキストが重要な情報密度の高いドキュメント |

## チャンク化前のテキスト前処理

テキストをチャンクに分割する前に、無関係なコンテンツをクリーンアップして検索品質を向上させることができます。

- **連続する空白、改行、タブを置換**

  - 3つ以上の連続する改行 → 2つの改行

  - 複数のスペース → 単一のスペース

  - タブ、フォームフィード、特殊なUnicodeスペース → 通常のスペース

- **すべてのURLとメールアドレスを削除**

    <Info>
      この設定は**全文**モードでは無視されます。
    </Info>

## 要約の自動生成を有効にする

<Info>セルフホストデプロイメントでのみ利用可能です。</Info>

すべてのチャンクの要約を自動生成し、検索性を向上させます。

要約も埋め込まれ、検索用にインデックスされます。要約がクエリにマッチすると、対応するチャンクも返されます。

自動生成された要約を手動で編集したり、後で特定のドキュメントの要約を再生成したりできます。詳細は[ナレッジコンテンツの管理](/ja/use-dify/knowledge/manage-knowledge/maintain-knowledge-documents)をご覧ください。

<Tip>
  視覚対応のLLMを選択した場合、要約はチャンクテキストと添付画像の両方に基づいて生成されます。
</Tip>

## チャンクのプレビュー

**プレビュー**をクリックして、コンテンツがどのようにチャンク化されるかを確認できます。クイックレビュー用に限られた数のチャンクが表示されます。

結果が期待通りでない場合は、最も近い設定を選択してください。後で手動でチャンクを微調整できます。詳細は[ナレッジコンテンツの管理](/ja/use-dify/knowledge/manage-knowledge/maintain-knowledge-documents)をご覧ください。

複数のドキュメントがある場合は、プレビューパネルの上部にあるファイル名をクリックして切り替えることができます。