---
title: インデックス方法と検索設定を指定
---

<Note> ⚠️ このドキュメントはAIによって自動翻訳されています。不正確な部分がある場合は、[英語版](/en/use-dify/knowledge/create-knowledge/setting-indexing-methods)を参照してください。</Note>

チャンキングモードを選択した後、次のステップは構造化されたコンテンツのインデックス方法を定義することです。

## インデックス方法の選択

検索エンジンが効率的なインデックスアルゴリズムを使用してユーザーのクエリに最も関連する検索結果をマッチングするように、選択したインデックス方法はLLMの検索効率とナレッジベースコンテンツに対する回答の正確性に直接影響します。

ナレッジベースでは、**高品質**と**エコノミー**の2種類のインデックス方法を提供しており、それぞれ異なる検索設定オプションがあります。

<Note>
    元の**Q&Aモード（コミュニティ版のみ対応）**は、高品質インデックス方法のオプション機能になりました。
</Note>

<Tabs>
  <Tab title="高品質">

    <Note>
      高品質インデックス方法で作成されたナレッジベースは、後からエコノミーに切り替えることはできません。
    </Note>

    高品質インデックス方法では、埋め込みモデルを使用してコンテンツチャンクをベクトル表現に変換します。このプロセスを埋め込み（embedding）と呼びます。
    
    これらのベクトルは多次元空間上の座標のようなものです。2つの点が近いほど、それらの意味が類似していることを示します。これにより、システムは単なるキーワード一致ではなく、意味的な類似性に基づいて関連情報を検索できます。

    <Tip>
      クロスモーダル検索（意味的関連性に基づいてテキストと画像の両方を取得）を有効にするには、マルチモーダル埋め込みモデル（**Vision**アイコン付き）を選択してください。ドキュメントから抽出された画像も埋め込まれ、検索用にインデックス化されます。

      このような埋め込みモデルを使用するナレッジベースは、カード上で**Multimodal**と表示されます。

      <img src="/images/multimodal_knowledge_base.png" alt="Multimodal Knowledge Base" width="300" />
    </Tip>

    高品質インデックス方法では、ベクトル検索、全文検索、ハイブリッド検索の3つの検索戦略がサポートされています。詳細は[検索設定の指定](#検索設定の指定)をご覧ください。

    ### Q&Aモード

    <Info>
      Q&Aモードはセルフホスト環境でのみ利用可能です。
    </Info>
    
    このモードを有効にすると、システムはアップロードされたテキストを分割し、各セグメントのコンテンツを要約した後、自動的にQ&Aペアを生成します。

    一般的な**Q to P**戦略（ユーザーの質問がテキスト段落にマッチング）と比較して、Q&Aモードでは**Q to Q**戦略（質問が質問にマッチング）を使用します。

    このアプローチは、FAQ文書内のテキストが**通常、完全な文法構造を持つ自然言語で書かれている**ため、特に効果的です。

    > **Q to Q**戦略により、質問と回答のマッチングがより明確になり、高頻度または類似度の高い質問のシナリオにも対応できます。

    ![Q&A チャンク](https://assets-docs.dify.ai/2024/12/70960a237d4f5eaed2dbf46a2cca2bf7.png)

    ユーザーが質問すると、システムは最も類似した質問を特定し、対応するチャンクを回答として返します。このアプローチは、ユーザーのクエリに直接マッチするため、より正確であり、ユーザーが必要とする正確な情報を検索するのに役立ちます。

    ![Q to P と Q to Q のインデックス方法の違い](https://assets-docs.dify.ai/2024/12/8745ccabff56290eae329a9d3592f745.png)

</Tab>

  <Tab title="エコノミー">

    各チャンクで10個のキーワードを使用して検索し、検索精度は低下しますがトークンは消費されません。検索されたブロックに対しては、最も関連性の高いブロックを選択するために転置インデックス方式のみが提供されます。

エコノミーインデックス方法のパフォーマンスが期待に沿わない場合は、ナレッジ設定ページで高品質インデックス方法にアップグレードできます。

![エコノミーモード](https://assets-docs.dify.ai/2024/12/3b86e6b484da39452c164cb6372a7242.png)

  </Tab>

</Tabs>

## 検索設定の指定

ナレッジベースがユーザーのクエリを受け取ると、事前設定された検索方法に従って既存のドキュメントを検索し、関連性の高いコンテンツチャンクを抽出します。これらのチャンクはLLMに不可欠なコンテキストを提供し、最終的に回答の正確性と信頼性に影響を与えます。

一般的な検索方法には以下があります：

1. ベクトル類似度に基づくセマンティック検索—テキストチャンクとクエリをベクトルに変換し、類似度スコアリングでマッチングします。
2. 転置インデックス（標準的な検索エンジン技術）を使用したキーワードマッチング。Difyのナレッジベースでは両方の方法がサポートされています。

両方の検索方法がDifyのナレッジベースでサポートされています。利用可能な具体的な検索オプションは、選択したインデックス方法によって異なります。

<Tabs>
  <Tab title="高品質">
    **高品質**

    **高品質**インデックス方法では、Difyは**ベクトル検索、全文検索、ハイブリッド検索**の3つの検索設定を提供しています。

![検索設定](https://assets-docs.dify.ai/2024/12/9b02fc353324221cc91f185a350775b6.png)

**ベクトル検索**

**定義**: ユーザーの質問をベクトル化してクエリベクトルを生成し、ナレッジベース内の対応するテキストベクトルと比較して、最も近いチャンクを見つけます。

![ベクトル検索設定](https://assets-docs.dify.ai/2024/12/620044faa47a5037f85b32a27a56fce5.png)

**ベクトル検索設定：**

**Rerankモデル**: デフォルトでは無効です。有効にすると、サードパーティのRerankモデルがベクトル検索で返されたテキストチャンクを並べ替えて結果を最適化します。これにより、LLMがより正確な情報にアクセスし、出力品質が向上します。このオプションを有効にする前に、**設定** → **モデルプロバイダー**でRerankモデルのAPIキーを設定してください。

<Note>
  選択した埋め込みモデルがマルチモーダルの場合は、マルチモーダルリランキングモデル（**Vision**アイコン付き）も選択してください。そうでない場合、検索された画像はリランキングと検索結果から除外されます。
</Note>

> この機能を有効にすると、Rerankモデルのトークンが消費されます。詳細については、関連するモデルの価格ページを参照してください。

**TopK**: ユーザーのクエリに最も類似していると判断されるテキストチャンクの取得数を決定します。また、選択したモデルのコンテキストウィンドウに基づいてチャンク数を自動的に調整します。デフォルト値は**3**で、値が高いほど多くのテキストチャンクが呼び出されます。

**Scoreしきい値**: チャンクが取得されるために必要な最小類似度スコアを設定します。このスコアを超えるチャンクのみが取得されます。デフォルト値は**0.5**です。しきい値が高いほど、より高い類似度が要求され、取得されるチャンク数が少なくなります。

> TopKとScore設定はRerankフェーズでのみ有効です。したがって、これらの設定を適用するには、Rerankモデルを追加して有効にする必要があります。

    ***

    **全文検索**

**定義:** ドキュメント内のすべての用語をインデックス化し、ユーザーが任意の用語をクエリして、それらの用語を含むテキストフラグメントを返すことができます。

![全文検索設定](https://assets-docs.dify.ai/2024/12/513bff1ca38ec746b3246502b0311b39.png)

**Rerankモデル**: デフォルトでは無効です。有効にすると、サードパーティのRerankモデルが全文検索で返されたテキストチャンクを並べ替えて結果を最適化します。これにより、LLMがより正確な情報にアクセスし、出力品質が向上します。このオプションを有効にする前に、**設定** → **モデルプロバイダー**でRerankモデルのAPIキーを設定してください。

<Note>
  選択した埋め込みモデルがマルチモーダルの場合は、マルチモーダルリランキングモデル（**Vision**アイコン付き）も選択してください。そうでない場合、検索された画像はリランキングと検索結果から除外されます。
</Note>

> この機能を有効にすると、Rerankモデルのトークンが消費されます。詳細については、関連するモデルの価格ページを参照してください。

**TopK**: ユーザーのクエリに最も類似していると判断されるテキストチャンクの取得数を決定します。また、選択したモデルのコンテキストウィンドウに基づいてチャンク数を自動的に調整します。デフォルト値は**3**で、値が高いほど多くのテキストチャンクが呼び出されます。

**Scoreしきい値**: チャンクが取得されるために必要な最小類似度スコアを設定します。このスコアを超えるチャンクのみが取得されます。デフォルト値は**0.5**です。しきい値が高いほど、より高い類似度が要求され、取得されるチャンク数が少なくなります。

> TopKとScore設定はRerankフェーズでのみ有効です。したがって、これらの設定を適用するには、Rerankモデルを追加して有効にする必要があります。

    ***

**ハイブリッド検索**

**定義**: このプロセスは全文検索とベクトル検索を組み合わせ、両方を同時に実行します。ユーザーのクエリに基づいて、両方の検索結果から最適なマッチング結果を選択する再順序付けステップが含まれます。

![ハイブリッド検索設定](https://assets-docs.dify.ai/2024/12/bd2621bfe8a1a8e21fca0743ec495a9e.png)

このモードでは、RerankモデルのAPIを設定せずに**「重み付け設定」**を指定するか、**Rerankモデル**を有効にして検索を行うことができます。

*   **重み付け設定**

    この機能により、ユーザーはセマンティック優先度とキーワード優先度にカスタム重みを設定できます。キーワード検索はナレッジベース内での全文検索を指し、セマンティック検索はナレッジベース内でのベクトル検索を指します。

    *   **セマンティック値を1にする**

        セマンティック検索モードのみを有効にします。埋め込みモデルを活用することで、クエリの正確な用語がナレッジベースに存在しなくても、ベクトル距離を計算することで検索の深度を高め、関連コンテンツを返すことができます。また、多言語コンテンツを扱う場合、セマンティック検索は異なる言語間の意味をキャプチャし、より正確なクロス言語検索結果を提供できます。
    *   **キーワード値を1にする**

        キーワード検索モードのみを有効にします。ナレッジベース内で入力テキストの完全一致を実行し、ユーザーが正確な情報や用語を知っているシナリオに適しています。このアプローチは計算リソースの消費が少なく、大規模なドキュメントナレッジベース内での迅速な検索に最適です。
    *   **キーワードとセマンティックの重みをカスタマイズする**

        セマンティック検索またはキーワード検索のみを有効にするだけでなく、柔軟なカスタム重み設定を提供しています。2つの方法の重みを継続的に調整して、ビジネスシナリオに適した最適な重み比率を見つけることができます。
    ***

      **Rerankモデル**

    デフォルトでは無効です。有効にすると、サードパーティのRerankモデルがハイブリッド検索で返されたテキストチャンクを並べ替えて結果を最適化します。これにより、LLMがより正確な情報にアクセスし、出力品質が向上します。このオプションを有効にする前に、**設定** → **モデルプロバイダー**でRerankモデルのAPIキーを設定してください。

    <Note>
      選択した埋め込みモデルがマルチモーダルの場合は、マルチモーダルリランキングモデル（**Vision**アイコン付き）も選択してください。そうでない場合、検索された画像はリランキングと検索結果から除外されます。
    </Note>

    > この機能を有効にすると、Rerankモデルのトークンが消費されます。詳細については、関連するモデルの価格ページを参照してください。

**「重み付け設定」**と**「Rerankモデル」**設定では、以下のオプションがサポートされています：

**TopK**: ユーザーのクエリに最も類似していると判断されるテキストチャンクの取得数を決定します。また、選択したモデルのコンテキストウィンドウに基づいてチャンク数を自動的に調整します。デフォルト値は**3**で、値が高いほど多くのテキストチャンクが呼び出されます。

**Scoreしきい値**: チャンクが取得されるために必要な最小類似度スコアを設定します。このスコアを超えるチャンクのみが取得されます。デフォルト値は**0.5**です。しきい値が高いほど、より高い類似度が要求され、取得されるチャンク数が少なくなります。
  </Tab>
  <Tab title="エコノミー">
    **エコノミー**

**エコノミーインデックス**モードでは、転置インデックスアプローチのみが利用可能です。転置インデックスは、ドキュメント内のキーワードを高速に検索するために設計されたデータ構造で、オンライン検索エンジンで一般的に使用されています。転置インデックスは**TopK**設定のみをサポートしています。

**TopK:** ユーザーのクエリに最も類似していると判断されるテキストチャンクの取得数を決定します。また、選択したモデルのコンテキストウィンドウに基づいてチャンク数を自動的に調整します。デフォルト値は**3**で、値が高いほど多くのテキストチャンクが呼び出されます。

<p align="center">
  <img src="https://assets-docs.dify.ai/2025/04/b417cd028131d34779993fbcbb8dbdd7.png" width="300" />
</p>

  </Tab>
</Tabs>

### 参考

検索設定を指定した後、以下のドキュメントを参照して、さまざまなシナリオでキーワードとコンテンツチャンクがどのようにマッチングされるかを確認できます。

<Card title="ナレッジ検索テスト" icon="link" href="/ja/use-dify/knowledge/test-retrieval">
ナレッジベース検索のテストと引用方法を学ぶ
</Card>