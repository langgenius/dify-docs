---
title: 環境変数
---

<Note> ⚠️ このドキュメントはAIによって自動翻訳されています。不正確な部分がある場合は、[英語版](/en/self-host/configuration/environments)を参照してください。</Note>

<Info>
このドキュメントは古い可能性があります。最新の設定ファイルを参照してください：

- [docker-compose.yaml](https://github.com/langgenius/dify/blob/5f8d20b5b2bb51f19547467167b18d9c0f6ffbb8/docker/docker-compose.yaml)

- [.env.example](https://github.com/langgenius/dify/blob/5f8d20b5b2bb51f19547467167b18d9c0f6ffbb8/docker/.env.example)
</Info>

## 共通変数

### CONSOLE_API_URL

コンソール API のバックエンド URL。認証コールバックの構築に使用されます。空の場合、デフォルトでアプリケーションと同じドメインになります。例: `https://api.console.dify.ai`

### CONSOLE_WEB_URL

コンソール Web インターフェースのフロントエンド URL。フロントエンドアドレスの構築と CORS 設定に使用されます。空の場合、デフォルトでアプリケーションと同じドメインになります。例: `https://console.dify.ai`

### SERVICE_API_URL

サービス API URL。フロントエンドにサービス API ベース URL を表示するために使用されます。空の場合、デフォルトでアプリケーションと同じドメインになります。例: `https://api.dify.ai`

### TRIGGER_URL

Webhook トリガーとプラグイントリガーでの Webhook コールバック URL のベース URL プレフィックス。

外部システムがアクセス可能なパブリックドメインまたは IP アドレスを指すようにしてください。

### APP_API_URL

WebApp API バックエンド URL。フロントエンド API のバックエンド URL を指定するために使用されます。空の場合、デフォルトでアプリケーションと同じドメインになります。例: `https://app.dify.ai`

### APP_WEB_URL

WebApp URL。ファイルプレビューまたはダウンロード URL をフロントエンドに表示したり、マルチモーダル入力として使用したりします。空の場合、デフォルトでアプリケーションと同じドメインになります。例: `https://udify.app/`

### FILES_URL

ファイルプレビューまたはダウンロード URL のプレフィックス。フロントエンドにこれらの URL を表示し、マルチモーダルモデルの入力として提供するために使用されます。偽造を防ぐため、画像プレビュー URL は署名され、5 分後に期限切れになります。

***

## サーバー

### MODE

起動モード：Docker を使用して起動する場合のみ利用可能です。ソースコードから実行する場合、適用されません。

- api: API サーバーを起動。
- worker: 非同期キュー worker を起動。

### DEBUG

デバッグモード：デフォルトで無効。ローカル開発中にこの設定を有効にして、モンキーパッチによる問題を防ぐことを推奨します。

### FLASK_DEBUG

Flask デバッグモード：有効にすると、API レスポンスにトレース情報を出力し、デバッグを容易にします。

### SECRET_KEY

セッション Cookie の安全な署名とデータベース内の機密情報の暗号化に使用される秘密鍵。

この変数は初回起動前に設定する必要があります。

`openssl rand -base64 42` を実行して強力な鍵を生成します。

### DEPLOY_ENV

デプロイ環境：

- PRODUCTION（デフォルト）：本番環境。
- TESTING：テスト環境。フロントエンドページにテスト環境を示す目立つ色のラベルが表示されます。

### LOG_LEVEL

ログ出力レベル。デフォルトは INFO。本番環境では ERROR に設定することを推奨します。

### MIGRATION_ENABLED

true に設定すると、コンテナ起動時にデータベース移行が自動的に実行されます。Docker を使用して起動する場合のみ利用可能で、ソースコードから実行する場合、適用されません。

ソースコード起動の場合、api ディレクトリで手動で `flask db upgrade` を実行する必要があります。

### CHECK_UPDATE_URL

バージョン確認ポリシーを制御します。false に設定すると、システムは `https://updates.dify.ai` を呼び出して更新を確認しません。

現在、CloudFlare Worker ベースのバージョン確認インターフェースは中国で直接アクセスできません。この変数を空の値に設定すると、この API 呼び出しが無効になります。

### TEXT_GENERATION_TIMEOUT_MS

デフォルト値：60000（ミリ秒）。テキスト生成とワークフロー処理のタイムアウトを指定します。この設定は、個々のプロセスが割り当て時間を超えることによるシステム全体のサービス中断を防ぎます。

### OPENAI_API_BASE

OpenAI ベースアドレスを変更するために使用、デフォルトは [https://api.openai.com/v1](https://api.openai.com/v1)。

中国で OpenAI にアクセスできない場合、国内ミラーアドレスに置き換えるか、ローカルモデルが OpenAI 互換 API を提供する場合に置き換えることができます。

### コンテナ起動関連設定

Docker イメージまたは docker-compose を使用して起動する場合のみ有効。

- DIFY_BIND_ADDRESS: API サービスバインドアドレス、デフォルト：0.0.0.0、つまりすべてのアドレスがアクセス可能。
- DIFY_PORT: API サービスバインドポート番号、デフォルト 5001。
- SERVER_WORKER_AMOUNT: API サーバー worker の数、つまり gevent worker の数。式：`cpu コア数 x 2 + 1`

  参考：[https://docs.gunicorn.org/en/stable/design.html#how-many-workers](https://docs.gunicorn.org/en/stable/design.html#how-many-workers)

- SERVER_WORKER_CLASS: デフォルトは gevent。Windows を使用する場合、sync または solo に切り替えることができます。
- GUNICORN_TIMEOUT: リクエスト処理タイムアウト。デフォルトは 200。より長い SSE（Server-Sent Events）接続時間をサポートするために 360 を推奨。
- CELERY_WORKER_CLASS: `SERVER_WORKER_CLASS` と同様。デフォルトは gevent。Windows を使用する場合、sync または solo に切り替えることができます。
- CELERY_WORKER_AMOUNT: Celery worker の数。デフォルトは 1、必要に応じて設定可能。
- COMPOSE_PROFILES: サービスグループを選択的に起動。デフォルト値は `${VECTOR_STORE:-weaviate},${DB_TYPE:-postgresql}`、`VECTOR_STORE` と `DB_TYPE` から自動的に派生。

### データベース設定

データベースは PostgreSQL を使用します。パブリックスキーマを使用してください。

- DB_TYPE: データベースタイプ。

  利用可能な値には以下が含まれます：

  - `postgresql`（デフォルト）
  - `mysql`
  - `oceanbase`
  - `seekdb`

- DB_USERNAME: ユーザー名
- DB_PASSWORD: パスワード
- DB_HOST: データベースホスト
- DB_PORT: データベースポート番号、デフォルトは 5432
- DB_DATABASE: データベース名
- SQLALCHEMY_POOL_SIZE: データベース接続プールのサイズ。デフォルトは 30 接続、適宜増加可能。
- SQLALCHEMY_POOL_RECYCLE: データベース接続プールのリサイクル時間、デフォルトは 3600 秒。
- SQLALCHEMY_ECHO: SQL を印刷するかどうか、デフォルトは false。

### Redis 設定

この Redis 設定はキャッシュと会話中の pub/sub に使用されます。

- REDIS_HOST: Redis ホスト
- REDIS_PORT: Redis ポート、デフォルトは 6379
- REDIS_DB: Redis データベース、デフォルトは 0。セッション Redis と Celery Broker とは異なるデータベースを使用してください。
- REDIS_USERNAME: Redis ユーザー名、デフォルトは空
- REDIS_PASSWORD: Redis パスワード、デフォルトは空。パスワードの設定を強く推奨。
- REDIS_USE_SSL: SSL プロトコルを使用して接続するかどうか、デフォルトは false
- REDIS_USE_SENTINEL: Redis Sentinel を使用して Redis サーバーに接続
- REDIS_SENTINELS: Sentinel ノード、形式：`<sentinel1_ip>:<sentinel1_port>,<sentinel2_ip>:<sentinel2_port>,<sentinel3_ip>:<sentinel3_port>`
- REDIS_SENTINEL_SERVICE_NAME: Sentinel サービス名、Master Name と同じ
- REDIS_SENTINEL_USERNAME: Sentinel ユーザー名
- REDIS_SENTINEL_PASSWORD: Sentinel パスワード
- REDIS_SENTINEL_SOCKET_TIMEOUT: Sentinel タイムアウト、デフォルト値：0.1、単位：秒

### Celery 設定

- CELERY_BROKER_URL

  形式は以下の通り（直接接続モード）：

  ```
  redis://<redis_username>:<redis_password>@<redis_host>:<redis_port>/<redis_database>
  ```

  例: `redis://:difyai123456@redis:6379/1`

  Sentinel モード：

  ```
  sentinel://<sentinel_username>:<sentinel_password>@<sentinel_host>:<sentinel_port>/<redis_database>
  ```

  例: `sentinel://localhost:26379/1;sentinel://localhost:26380/1;sentinel://localhost:26381/1`

- BROKER_USE_SSL: true に設定すると、SSL プロトコルを使用して接続、デフォルトは false
- CELERY_USE_SENTINEL: true に設定すると、Sentinel モードが有効、デフォルトは false
- CELERY_SENTINEL_MASTER_NAME: Sentinel のサービス名、つまり Master Name
- CELERY_SENTINEL_SOCKET_TIMEOUT: Sentinel への接続タイムアウト、デフォルト値：0.1、単位：秒

### CORS 設定

フロントエンドクロスドメインアクセスポリシーの設定に使用されます。

- CONSOLE_CORS_ALLOW_ORIGINS\
  コンソール CORS クロスドメインポリシー、デフォルトは `*`、つまりすべてのドメインがアクセス可能。

- WEB_API_CORS_ALLOW_ORIGINS\
  WebAPP CORS クロスドメインポリシー、デフォルトは `*`、つまりすべてのドメインがアクセス可能。

- COOKIE_DOMAIN\
  フロントエンドとバックエンドが異なるサブドメインで実行される場合、`COOKIE_DOMAIN` をサイトのトップレベルドメイン（例: `example.com`）に設定します。\
  フロントエンドとバックエンドは同じトップレベルドメインに存在する必要があります。

- NEXT_PUBLIC_COOKIE_DOMAIN\
  フロントエンドとバックエンドが異なるサブドメインで実行される場合、`NEXT_PUBLIC_COOKIE_DOMAIN` を `1` に設定します。\
  フロントエンドとバックエンドは同じトップレベルドメインに存在する必要があります。

### ファイルストレージ設定

アップロードされたデータセットファイル、チーム/テナント暗号化キー、その他のファイルを保存するために使用されます。

- STORAGE_TYPE

  ストレージ施設タイプ

  - local（デフォルト）：ローカルファイルストレージ、このオプションを選択する場合、以下の `STORAGE_LOCAL_PATH` 設定が必要です。

  - s3: S3 オブジェクトストレージ、このオプションを選択する場合、以下の S3\_ プレフィックスの設定が必要です。

  - azure-blob: Azure Blob オブジェクトストレージ、このオプションを選択する場合、以下の AZURE_BLOB\_ プレフィックスの設定が必要です。

  - aliyun-oss: Alibaba Cloud OSS オブジェクトストレージ、このオプションを選択する場合、以下の ALIYUN_OSS\_ プレフィックスの設定が必要です。

  - huawei-obs: Huawei OBS オブジェクトストレージ、このオプションを選択する場合、以下の HUAWEI_OBS\_ プレフィックスの設定が必要です。

  - volcengine-tos: Volcengine TOS オブジェクトストレージ、このオプションを選択する場合、以下の VOLCENGINE_TOS\_ プレフィックスの設定が必要です。

  - tencent-cos: Tencent Cloud COS オブジェクトストレージ、このオプションを選択する場合、以下の TENCENT_COS\_ プレフィックスの設定が必要です。

- STORAGE_LOCAL_PATH

  デフォルトは storage、つまり現在のディレクトリの storage ディレクトリに保存されます。

  docker または docker-compose を使用してデプロイする場合、両方のコンテナで `/app/api/storage` ディレクトリを同じローカルディレクトリにマウントしてください、そうでないとファイルが見つからないエラーが発生する可能性があります。

- S3_ENDPOINT: S3 エンドポイントアドレス
- S3_BUCKET_NAME: S3 バケット名
- S3_ACCESS_KEY: S3 アクセスキー
- S3_SECRET_KEY: S3 シークレットキー
- S3_REGION: S3 リージョン情報、例: us-east-1
- AZURE_BLOB_ACCOUNT_NAME: your-account-name 例 'difyai'
- AZURE_BLOB_ACCOUNT_KEY: your-account-key 例 'difyai'
- AZURE_BLOB_CONTAINER_NAME: your-container-name 例 'difyai-container'
- AZURE_BLOB_ACCOUNT_URL: 'https://your_account_name.blob.core.windows.net'
- ALIYUN_OSS_BUCKET_NAME: your-bucket-name 例 'difyai'
- ALIYUN_OSS_ACCESS_KEY: your-access-key 例 'difyai'
- ALIYUN_OSS_SECRET_KEY: your-secret-key 例 'difyai'
- ALIYUN_OSS_ENDPOINT: https://oss-ap-southeast-1-internal.aliyuncs.com # 参考: https://www.alibabacloud.com/help/en/oss/user-guide/regions-and-endpoints
- ALIYUN_OSS_REGION: ap-southeast-1 # 参考: https://www.alibabacloud.com/help/en/oss/user-guide/regions-and-endpoints
- ALIYUN_OSS_AUTH_VERSION: v4
- ALIYUN_OSS_PATH: your-path # '/' で始まらない。OSS はオブジェクト名での先頭スラッシュをサポートしない。参考: https://www.alibabacloud.com/help/en/oss/support/0016-00000005
- HUAWEI_OBS_BUCKET_NAME: your-bucket-name 例 'difyai'
- HUAWEI_OBS_SECRET_KEY: your-secret-key 例 'difyai'
- HUAWEI_OBS_ACCESS_KEY: your-access-key 例 'difyai'
- HUAWEI_OBS_SERVER: your-server-url # 参考: https://support.huaweicloud.com/sdk-python-devg-obs/obs_22_0500.html
- VOLCENGINE_TOS_BUCKET_NAME: your-bucket-name 例 'difyai'
- VOLCENGINE_TOS_SECRET_KEY: your-secret-key 例 'difyai'
- VOLCENGINE_TOS_ACCESS_KEY: your-access-key 例 'difyai'
- VOLCENGINE_TOS_REGION: your-region 例 'cn-guangzhou' # 参考: https://www.volcengine.com/docs/6349/107356
- VOLCENGINE_TOS_ENDPOINT: your-endpoint 例 'tos-cn-guangzhou.volces.com' # 参考: https://www.volcengine.com/docs/6349/107356
- TENCENT_COS_BUCKET_NAME: your-bucket-name 例 'difyai'
- TENCENT_COS_SECRET_KEY: your-secret-key 例 'difyai'
- TENCENT_COS_SECRET_ID: your-secret-id 例 'difyai'
- TENCENT_COS_REGION: your-region 例 'ap-guangzhou' # 参考: https://cloud.tencent.com/document/product/436/6224
- TENCENT_COS_SCHEME: COS にアクセスするための http/https プロトコルを指定

### ベクトルデータベース設定

- VECTOR_STORE

  利用可能な値には以下が含まれます：

  - `weaviate`
  - `qdrant`
  - `milvus`
  - `zilliz`（`milvus` と同じ設定を共有）
  - `myscale`
  - `pinecone`（まだオープンではない）
  - `analyticdb`
  - `couchbase`
  - `oceanbase`
  - `seekdb`（`oceanbase` と同じ設定を共有）
  - `tablestore`
  - `lindorm`
  - `tencent`
  - `opengauss`

- WEAVIATE_ENDPOINT

  Weaviate エンドポイントアドレス、例: `http://weaviate:8080`。

- WEAVIATE_API_KEY

  Weaviate に接続するための api-key クレデンシャル。

- WEAVIATE_BATCH_SIZE

  Weaviate でバッチで作成されるインデックスオブジェクトの数、デフォルトは 100。

  このドキュメントを参照: [https://weaviate.io/developers/weaviate/manage-data/import#how-to-set-batch-parameters](https://weaviate.io/developers/weaviate/manage-data/import#how-to-set-batch-parameters)

- WEAVIATE_GRPC_ENABLED

  gRPC メソッドを使用して Weaviate と対話するかどうか、有効にするとパフォーマンスが大幅に向上する可能性がある、ローカルでは使用できない場合がある、デフォルトは true。

- QDRANT_URL

  Qdrant エンドポイントアドレス、例: `https://your-qdrant-cluster-url.qdrant.tech/`

- QDRANT_API_KEY

  Qdrant に接続するための api-key クレデンシャル。

- PINECONE_API_KEY

  Pinecone に接続するための api-key クレデンシャル。

- PINECONE_ENVIRONMENT

  Pinecone が存在する環境、例: `us-east4-gcp`

- MILVUS_URI

  Milvus uri 設定、例 `http://host.docker.internal:19530`。[Zilliz Cloud](https://docs.zilliz.com/docs/free-trials) の場合、uri と token をパブリックエンドポイントと API キーに調整。

- MILVUS_TOKEN

  Milvus token 設定、デフォルトは空。

- MILVUS_USER

  Milvus ユーザー設定、デフォルトは空。

- MILVUS_PASSWORD

  Milvus パスワード設定、デフォルトは空。

- MYSCALE_HOST

  MyScale ホスト設定。

- MYSCALE_PORT

  MyScale ポート設定。

- MYSCALE_USER

  MyScale ユーザー設定、デフォルトは `default`。

- MYSCALE_PASSWORD

  MyScale パスワード設定、デフォルトは空。

- MYSCALE_DATABASE

  MyScale データベース設定、デフォルトは `default`。

- MYSCALE_FTS_PARAMS

  MyScale テキスト検索パラメータ、[MyScale ドキュメント](https://myscale.com/docs/en/text-search/#understanding-fts-index-parameters) をチェックして多言語サポート、デフォルトは空。

- ANALYTICDB_KEY_ID

  Aliyun OpenAPI 認証に使用されるアクセスキー ID。[Analyticdb ドキュメント](https://help.aliyun.com/zh/analyticdb/analyticdb-for-postgresql/support/create-an-accesskey-pair) を読んで AccessKey を作成。

- ANALYTICDB_KEY_SECRET

  Aliyun OpenAPI 認証に使用されるアクセスキー秘密。

- ANALYTICDB_INSTANCE_ID

  AnalyticDB インスタンスの一意の識別子、例: `gp-xxxxxx`。[Analyticdb ドキュメント](https://help.aliyun.com/zh/analyticdb/analyticdb-for-postgresql/getting-started/create-an-instance-1) を読んでインスタンスを作成。

- ANALYTICDB_REGION_ID

  AnalyticDB インスタンスが配置されているリージョン識別子、例: `cn-hangzhou`。

- ANALYTICDB_ACCOUNT

  AnalyticDB インスタンスに接続するために使用されるアカウント名。[Analyticdb ドキュメント](https://help.aliyun.com/zh/analyticdb/analyticdb-for-postgresql/getting-started/createa-a-privileged-account) を読んでアカウントを作成。

- ANALYTICDB_PASSWORD

  AnalyticDB インスタンスに接続するために使用されるアカウントのパスワード。

- ANALYTICDB_NAMESPACE

  AnalyticDB インスタンス内で対話したい名前空間（schema）、例 `dify`。この名前空間が存在しない場合、自動的に作成されます。

- ANALYTICDB_NAMESPACE_PASSWORD

  名前空間（schema）のパスワード。この名前空間が存在しない場合、このパスワードで作成されます。

- COUCHBASE_CONNECTION_STRING

  Couchbase クラスタの接続文字列。

- COUCHBASE_USER

  データベースユーザーのユーザー名。

- COUCHBASE_PASSWORD

  データベースユーザーのパスワード。

- COUCHBASE_BUCKET_NAME

  使用するバケットの名前。

- COUCHBASE_SCOPE_NAME

  使用するスコープの名前。

- OCEANBASE_VECTOR_HOST

  OceanBase または seekdb ベクトルデータベースのホスト名または IP アドレス。

- OCEANBASE_VECTOR_PORT

  OceanBase または seekdb ベクトルデータベースのポート。

- OCEANBASE_VECTOR_USER

  OceanBase または seekdb ベクトルデータベースのユーザー名。

- OCEANBASE_VECTOR_PASSWORD

  OceanBase または seekdb ベクトルデータベースユーザーのパスワード。

- OCEANBASE_VECTOR_DATABASE

  OceanBase または seekdb ベクトルデータベースのデータベース名。

- OCEANBASE_CLUSTER_NAME

  OceanBase または seekdb ベクトルデータベースのクラスタ名、Docker デプロイの場合のみ利用可能。

- OCEANBASE_MEMORY_LIMIT

  OceanBase ベクトルデータベースのメモリ制限、Docker デプロイの場合のみ利用可能。

- SEEKDB_MEMORY_LIMIT

  seekdb ベクトルデータベースのメモリ制限、Docker デプロイの場合のみ利用可能。

- TABLESTORE_ENDPOINT

  TableStore サーバーのエンドポイントアドレス（例 'https://instance-name.cn-hangzhou.ots.aliyuncs.com'）

- TABLESTORE_INSTANCE_NAME

  TableStore サーバーにアクセスするためのインスタンス名（例 'instance-name'）

- TABLESTORE_ACCESS_KEY_ID

  インスタンス名の accessKey id

- TABLESTORE_ACCESS_KEY_SECRET

  インスタンス名の accessKey secret

- LINDORM_URL

  LINDORM 検索エンジンの URL、[コンソール](https://lindorm.console.aliyun.com/) から取得可能

- LINDORM_USERNAME

  lindorm 検索エンジンのユーザー名

- LINDORM_PASSWORD

  lindorm 検索エンジンのパスワード

- TENCENT_VECTOR_DB_URL

  Tencent Cloud VectorDB のアクセスアドレスは [コンソール](https://console.cloud.tencent.com/vdb) から取得可能。

- TENCENT_VECTOR_DB_API_KEY

  VectorDB サーバーの API キー（パスワード）、アイデンティティ認証に使用。[キー管理](https://cloud.tencent.com/document/product/1709/95108)。

- TENCENT_VECTOR_DB_USERNAME

  ベクトルデータベースアカウント、デフォルト 'root'。[アカウント管理](https://cloud.tencent.com/document/product/1709/115833)。

- TENCENT_VECTOR_DB_TIMEOUT

  デフォルトのリクエストタイムアウト期間を設定。

- TENCENT_VECTOR_DB_DATABASE

  データを保存するためのデータベースを設定。[データベース作成](https://cloud.tencent.com/document/product/1709/95822)。

- TENCENT_VECTOR_DB_SHARD

  シャード数を指定。

- TENCENT_VECTOR_DB_REPLICAS

  レプリカ数を指定。

- TENCENT_VECTOR_DB_ENABLE_HYBRID_SEARCH

  HybridSearch を有効にするかどうかを指定。[スパースベクトルドキュメント](https://cloud.tencent.com/document/product/1709/110110)。

- MATRIXONE_HOST

  Matrixone データベースのホスト、デフォルト値は matrixone。

- MATRIXONE_PORT

  Matrixone データベースのポート、デフォルト値は 6001。

- MATRIXONE_USER

  Matrixone データベースのユーザー、デフォルト値は dump。

- MATRIXONE_PASSWORD

  Matrixone データベースのパスワード、デフォルト値は 111。

- MATRIXONE_DATABASE

  Matrixone データベースのデータベース、デフォルト値は dify。

- OPENGAUSS_HOST

  openGauss ベクトルデータベースのホスト名または IP アドレス。

- OPENGAUSS_PORT

  openGauss ベクトルデータベースのポート。

- OPENGAUSS_USER

  openGauss ベクトルデータベースのユーザー名。

- OPENGAUSS_PASSWORD

  openGauss ベクトルデータベースのパスワード。

- OPENGAUSS_DATABASE

  openGauss ベクトルデータベースのデータベース名。

- OPENGAUSS_MIN_CONNECTION

  openGauss ベクトルデータベースの最小接続数。

- OPENGAUSS_MAX_CONNECTION

  openGauss ベクトルデータベースの最大接続数。

- OPENGAUSS_ENABLE_PQ

  openGauss ベクトルデータベースの PQ アクセラレーションを有効化。

### 知識設定

- UPLOAD_FILE_SIZE_LIMIT\
  アップロードファイルの最大許可サイズ（メガバイト単位）。デフォルト 15。

- UPLOAD_FILE_BATCH_LIMIT\
  単一バッチでアップロード可能な最大ファイル数。デフォルト 5。

- SINGLE_CHUNK_ATTACHMENT_LIMIT\
  単一チャンクに添付可能な最大ファイル数。デフォルト 10。

- IMAGE_FILE_BATCH_LIMIT\
  単一バッチでアップロード可能な最大画像添付数。デフォルト 10。

- ATTACHMENT_IMAGE_FILE_SIZE_LIMIT\
  画像添付の最大許可サイズ（メガバイト単位）。デフォルト 2。

- ATTACHMENT_IMAGE_DOWNLOAD_TIMEOUT\
  画像添付のダウンロードタイムアウト（秒単位）。デフォルト 60。

- ETL_TYPE\
  利用可能な値には以下が含まれます：

  - `dify`: Dify の独自ファイル抽出スキーム
  - `Unstructured`: Unstructured.io ファイル抽出スキーム

- UNSTRUCTURED_API_URL\
  Unstructured API パス、ETL_TYPE が Unstructured の場合に設定が必要。\
  例: `http://unstructured:8000/general/v0/general`

- TOP_K_MAX_VALUE\
  RAG の最大 top-k 値、デフォルト 10。

### マルチモーダル設定

- MULTIMODAL_SEND_IMAGE_FORMAT

  マルチモーダルモデル入力時に送信される画像の形式、デフォルトは `base64`、オプション `url`。`url` モードの呼び出し遅延は `base64` モードよりも低い。通常、より互換性のある `base64` モードを使用することを推奨。`url` に設定する場合、`FILES_URL` を外部アクセス可能なアドレスに設定して、マルチモーダルモデルが画像にアクセスできるようにする必要があります。

- UPLOAD_IMAGE_FILE_SIZE_LIMIT: アップロード画像ファイルサイズ制限、デフォルト 10M。

### Sentry 設定

アプリケーション監視とエラーログ追跡に使用されます。

- SENTRY_DSN: Sentry DSN アドレス、デフォルトは空、空の場合、すべての監視情報が Sentry に報告されません。
- SENTRY_TRACES_SAMPLE_RATE: Sentry イベントの報告比率、0.01 の場合 1%。
- SENTRY_PROFILES_SAMPLE_RATE: Sentry profiles の報告比率、0.01 の場合 1%。

### Notion 統合設定

Notion 統合設定変数は Notion 統合を申請することで取得できます：[https://www.notion.so/my-integrations](https://www.notion.so/my-integrations)

- NOTION_INTEGRATION_TYPE: "public" または "internal" に設定。Notion の OAuth リダイレクト URL は HTTPS のみをサポートするため、ローカルデプロイの場合、Notion の内部統合を使用してください。
- NOTION_CLIENT_SECRET: Notion OAuth クライアント秘密（パブリック統合タイプ用）
- NOTION_CLIENT_ID: OAuth クライアント ID（パブリック統合タイプ用）
- NOTION_INTERNAL_SECRET: Notion 内部統合秘密。`NOTION_INTEGRATION_TYPE` の値が "internal" の場合、この変数を設定する必要があります。

### メール関連設定

- MAIL_TYPE

  - resend
    - MAIL_DEFAULT_SEND_FROM: 送信者のメール名、例: no-reply [no-reply@dify.ai](mailto:no-reply@dify.ai)、必須ではない。
    - RESEND_API_KEY: Resend メールプロバイダーの API-Key、API-Key から取得可能。

  - smtp
    - SMTP_SERVER: SMTP サーバーアドレス
    - SMTP_PORT: SMTP サーバーポート番号
    - SMTP_USERNAME: SMTP ユーザー名
    - SMTP_PASSWORD: SMTP パスワード
    - SMTP_USE_TLS: TLS を使用するかどうか、デフォルトは false
    - MAIL_DEFAULT_SEND_FROM: 送信者のメール名、例: no-reply [no-reply@dify.ai](mailto:no-reply@dify.ai)、必須ではない。

  - sendgrid
    - SENDGRID_API_KEY: SendGrid メールプロバイダーの API キー。
    - MAIL_DEFAULT_SEND_FROM: 送信者メールアドレス、例 your_email@sendgrid.com。このフィールドは SendGrid 認証に必要です。

SendGrid メールプロバイダーの詳細については、[SendGrid ドキュメント](https://sendgrid.com/docs/for-developers/sending-email/) を参照してください。

### ModelProvider & Tool Position 設定

アプリケーションで利用可能なモデルプロバイダーとツールを指定するために使用されます。これらの設定により、どのツールとモデルプロバイダーが利用可能か、およびアプリケーションインターフェースでの順序と包含/除外をカスタマイズできます。

利用可能な [ツール](https://github.com/langgenius/dify/blob/main/api/core/tools/provider/_position.yaml) と [モデルプロバイダー](https://github.com/langgenius/dify/blob/main/api/core/model_runtime/model_providers/_position.yaml) のリストについては、提供されたリンクを参照してください。

- POSITION_TOOL_PINS

  特定のツールをリストの先頭に固定し、インターフェースで最初に表示されるようにします。（項目間に**スペースなし**のコンマ区切り値を使用。）

  例: `POSITION_TOOL_PINS=bing,google`

- POSITION_TOOL_INCLUDES

  アプリケーションに含めるツールを指定します。ここにリストされたツールのみが利用可能です。設定されていない場合、POSITION_TOOL_EXCLUDES で指定されていない限り、すべてのツールが含まれます。（項目間に**スペースなし**のコンマ区切り値を使用。）

  例: `POSITION_TOOL_INCLUDES=bing,google`

- POSITION_TOOL_EXCLUDES

  アプリケーションから特定のツールを除外します。ここにリストされたツールは利用可能なオプションから省略され、固定ツールを除きます。（項目間に**スペースなし**のコンマ区切り値を使用。）

  例: `POSITION_TOOL_EXCLUDES=yahoo,wolframalpha`

- POSITION_PROVIDER_PINS

  特定のモデルプロバイダーをリストの先頭に固定し、インターフェースで最初に表示されるようにします。（項目間に**スペースなし**のコンマ区切り値を使用。）

  例: `POSITION_PROVIDER_PINS=openai,openllm`

- POSITION_PROVIDER_INCLUDES

  アプリケーションに含めるモデルプロバイダーを指定します。ここにリストされたプロバイダーのみが利用可能です。設定されていない場合、POSITION_PROVIDER_EXCLUDES で指定されていない限り、すべてのプロバイダーが含まれます。（項目間に**スペースなし**のコンマ区切り値を使用。）

  例: `POSITION_PROVIDER_INCLUDES=cohere,upstage`

- POSITION_PROVIDER_EXCLUDES

  アプリケーションから特定のモデルプロバイダーを除外します。ここにリストされたプロバイダーは利用可能なオプションから省略され、固定プロバイダーを除きます。（項目間に**スペースなし**のコンマ区切り値を使用。）

  例: `POSITION_PROVIDER_EXCLUDES=openrouter,ollama`

### スケジュールタスク設定

Dify は Celery Beat を使用して、システムメンテナンスとデータクリーンアップのためのさまざまなバックグラウンドスケジュールタスクを実行します。以下の環境変数はスケジュールタスク設定を構成します：

- CELERY_BEAT_SCHEDULER_TIME

  Celery Beat スケジューリング時間間隔（日単位）、特定のスケジュールタスクの実行頻度を制御。デフォルトは 1 日。

- ENABLE_CLEAN_EMBEDDING_CACHE_TASK

  埋め込みキャッシュクリーンアップタスクを有効にするかどうか。デフォルトは false。有効にすると、毎日午前 2:00 に期限切れの埋め込みキャッシュをクリーンアップしてストレージ使用量を削減。

- ENABLE_CLEAN_UNUSED_DATASETS_TASK

  未使用データセットクリーンアップタスクを有効にするかどうか。デフォルトは false。有効にすると、毎日午前 3:00 に長期未使用のデータセットをクリーンアップしてストレージスペースを解放。

- ENABLE_CLEAN_MESSAGES

  メッセージクリーンアップタスクを有効にするかどうか。デフォルトは false。有効にすると、毎日午前 4:00 に期限切れの会話メッセージレコードをクリーンアップ。

- ENABLE_MAIL_CLEAN_DOCUMENT_NOTIFY_TASK

  メールドキュメントクリーンアップ通知タスクを有効にするかどうか。デフォルトは false。有効にすると、毎週月曜日の午前 10:00 にドキュメントクリーンアップ通知メールを送信。

- ENABLE_DATASETS_QUEUE_MONITOR

  データセットキュー監視タスクを有効にするかどうか。デフォルトは false。有効にすると、データセット処理キューステータスを監視し、キュー積圧がしきい値を超えた場合にアラートを送信。

- QUEUE_MONITOR_INTERVAL

  データセットキュー監視間隔（分単位）。デフォルトは 30 分。キューモニタリングタスクが有効な場合のみ有効。

- ENABLE_CHECK_UPGRADABLE_PLUGIN_TASK

  アップグレード可能プラグイン確認タスクを有効にするかどうか。デフォルトは true。有効にすると、15 分ごとにアップグレード可能なプラグインバージョンを確認。MARKETPLACE_ENABLED を有効にする必要があります。

- MARKETPLACE_ENABLED

  マーケットプレイス機能を有効にするかどうか。デフォルトは true。無効にすると、プラグイン関連機能（プラグインアップグレードチェックを含む）が利用できなくなります。

- ENABLE_CREATE_TIDB_SERVERLESS_TASK

  TiDB Serverless 作成タスクを有効にするかどうか。デフォルトは false。TiDB クラウドサービス統合用、毎時間実行。

- ENABLE_UPDATE_TIDB_SERVERLESS_STATUS_TASK

  TiDB Serverless ステータス更新タスクを有効にするかどうか。デフォルトは false。TiDB クラウドサービスステータスを更新するため、10 分ごとに実行。

- WORKFLOW_LOG_CLEANUP_ENABLED

  自動ワークフローログクリーンアップタスクを有効にするかどうか。デフォルトは false。有効にすると、毎日午前 2:00 に保持期間を超えたワークフロー実行ログをクリーンアップ。

- WORKFLOW_LOG_RETENTION_DAYS

  ワークフローログ保持日数。デフォルトは 30 日。ワークフローログクリーンアップタスクが有効な場合のみ有効。

- WORKFLOW_LOG_CLEANUP_BATCH_SIZE

  ワークフローログクリーンアップバッチサイズ。デフォルトは 100。各クリーンアップ操作で処理されるログエントリ数、システムパフォーマンスに基づいて調整可能。

### その他

- INVITE_EXPIRY_HOURS: メンバー招待リンク有効時間（時間）、デフォルト: 72。
- HTTP_REQUEST_NODE_MAX_TEXT_SIZE: ワークフロー内の HTTP リクエストノードの最大テキストサイズ、デフォルト 1MB。
- HTTP_REQUEST_NODE_MAX_BINARY_SIZE: ワークフロー内の HTTP リクエストノードの最大バイナリサイズ、デフォルト 10MB。

---

## Web フロントエンド

### SENTRY_DSN

Sentry DSN アドレス、デフォルトは空、空の場合、すべての監視情報が Sentry に報告されません。

## 非推奨

### CONSOLE_URL

> ⚠️ 0.3.8 で変更、0.4.9 で非推奨、以下に置き換え：`CONSOLE_API_URL` と `CONSOLE_WEB_URL`。

コンソール URL、認証コールバックの構築、コンソールフロントエンドアドレス、CORS 設定使用に使用されます。空の場合、同じドメイン。例: `https://console.dify.ai`。

### API_URL

> ⚠️ 0.3.8 で変更、0.4.9 で非推奨、以下に置き換え `SERVICE_API_URL`。

API URL、フロントエンドにサービス API ベース URL を表示するために使用されます。空の場合、同じドメイン。例: `https://api.dify.ai`

### APP_URL

> ⚠️ 0.3.8 で変更、0.4.9 で非推奨、以下に置き換え `APP_API_URL` と `APP_WEB_URL`。

WebApp Url、フロントエンドに WebAPP API ベース Url を表示するために使用されます。空の場合、同じドメイン。例: `https://udify.app/`

### セッション設定

> ⚠️ v0.3.24 以降、この設定は有効ではありません。

API サービスによるインターフェースアイデンティティ検証にのみ使用されます。

- SESSION_TYPE: セッションコンポーネントタイプ

  - redis（デフォルト）：この場合、以下の SESSION_REDIS\_ で始まる環境変数を設定する必要があります。
  - sqlalchemy：この場合、現在のデータベース接続を使用し、sessions テーブルを使用してセッションレコードの読み書きを行います。

- SESSION_REDIS_HOST: Redis ホスト
- SESSION_REDIS_PORT: Redis ポート、デフォルトは 6379
- SESSION_REDIS_DB: Redis データベース、デフォルトは 0。Redis と Celery Broker とは異なるデータベースを使用してください。
- SESSION_REDIS_USERNAME: Redis ユーザー名、デフォルトは空
- SESSION_REDIS_PASSWORD: Redis パスワード、デフォルトは空。パスワードの設定を強く推奨。
- SESSION_REDIS_USE_SSL: SSL プロトコルを使用して接続するかどうか、デフォルトは false

### Cookie ポリシー設定

> ⚠️ v0.3.24 以降、この設定は有効ではありません。

アイデンティティ検証に使用されるセッション Cookie のブラウザポリシーの設定に使用されます。

- COOKIE_HTTPONLY: Cookie HttpOnly 設定、デフォルトは true。
- COOKIE_SAMESITE: Cookie SameSite 設定、デフォルトは Lax。
- COOKIE_SECURE: Cookie Secure 設定、デフォルトは false。

## チャンク長設定

### INDEXING_MAX_SEGMENTATION_TOKENS_LENGTH

長いドキュメントを処理する際のテキストセグメントサイズを制御するためのドキュメントチャンク長設定。デフォルト: 500。最大: 4000。

**大きなチャンク**
- 各チャンク内でより多くのコンテキストを保持し、テキストのより広範な理解を必要とするタスクに適しています。
- チャンク総数を減らし、処理時間とストレージオーバーヘッドを低下させます。

**小さなチャンク**
- より細かい粒度を提供し、抽出や要約などのタスクの精度を向上させます。
- モデルトークン制限を超えるリスクを減らし、より厳格な制約を持つモデルに対してより安全です。

**設定推奨**
- 感情分析やドキュメント要約などのコンテキスト集約型タスクでは大きなチャンクを選択。
- キーワード抽出や段落レベル処理などの細粒度タスクでは小さなチャンクを選択。
