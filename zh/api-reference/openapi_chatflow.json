{
  "openapi": "3.0.1",
  "info": {
    "title": "高级对话型应用 API",
    "description": "对话型应用支持会话持久化，允许将之前的聊天历史作为响应的上下文。这适用于聊天机器人、客服 AI 等场景。此版本包含高级功能，如工作流事件和更详细的文件类型支持。",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "{api_base_url}",
      "description": "高级对话型应用 API 的基础 URL。请将 {api_base_url} 替换为您的应用提供的实际 API 基础 URL（例如，来自 props.appDetail.api_base_url）。",
      "variables": {
        "api_base_url": {
          "default": "https://api.dify.ai/v1",
          "description": "API 的实际基础 URL"
        }
      }
    }
  ],
  "security": [
    {
      "ApiKeyAuth": []
    }
  ],
  "paths": {
    "/chat-messages": {
      "post": {
        "summary": "发送对话消息",
        "description": "向高级对话型应用发送请求，支持多种文件类型和工作流事件。",
        "operationId": "sendAdvancedChatMessage",
        "tags": [
          "Chatflow"
        ],
        "requestBody": {
          "description": "发送高级对话消息的请求体。",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdvancedChatRequest"
              },
              "examples": {
                "streaming_with_file_and_workflow": {
                  "summary": "带图片文件的流式模式示例",
                  "value": {
                    "inputs": {
                      "user_name": "Alice"
                    },
                    "query": "Analyze this document and tell me its sentiment.",
                    "response_mode": "streaming",
                    "conversation_id": "conv_12345",
                    "user": "user_alice",
                    "files": [
                      {
                        "type": "document",
                        "transfer_method": "remote_url",
                        "url": "https://example.com/mydoc.pdf"
                      }
                    ],
                    "auto_generate_name": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功响应。内容类型和结构取决于 `response_mode`。\n- `blocking`：返回 `application/json` 格式的 `ChatCompletionResponse`。\n- `streaming`：返回 `text/event-stream` 格式的 `ChunkAdvancedChatEvent` 流。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatCompletionResponse"
                }
              },
              "text/event-stream": {
                "schema": {
                  "type": "string",
                  "description": "Server-Sent Events 流。有关结构，请参阅 `ChunkAdvancedChatEvent`。"
                },
                "examples": {
                  "workflow_events_example": {
                    "summary": "包含工作流事件的示例流",
                    "value": "data: {\"event\": \"workflow_started\", \"task_id\": \"task_abc\", \"workflow_run_id\": \"wf_run_1\", \"data\": {\"id\": \"wf_run_1\", \"workflow_id\": \"wf_def_xyz\", \"sequence_number\": 1, \"created_at\": 1705395332}}\n\ndata: {\"event\": \"node_started\", \"task_id\": \"task_abc\", \"workflow_run_id\": \"wf_run_1\", \"data\": {\"id\": \"node_run_1\", \"node_id\": \"node_start\", \"node_type\": \"start\", \"title\": \"Start Node\", \"index\": 0, \"inputs\": {}, \"created_at\": 1705395333}}\n\ndata: {\"event\": \"message\", \"task_id\": \"task_abc\", \"message_id\": \"msg_123\", \"conversation_id\": \"conv_123\", \"answer\": \"Processing... \", \"created_at\": 1705395334}\n\ndata: {\"event\": \"node_finished\", \"task_id\": \"task_abc\", \"workflow_run_id\": \"wf_run_1\", \"data\": {\"id\": \"node_run_1\", \"node_id\": \"node_start\", \"node_type\": \"start\", \"title\": \"Start Node\", \"index\": 0, \"status\": \"succeeded\", \"elapsed_time\": 0.5, \"created_at\": 1705395333}}\n\ndata: {\"event\": \"message_end\", \"task_id\": \"task_abc\", \"message_id\": \"msg_123\", \"conversation_id\": \"conv_123\", \"metadata\": {\"usage\": {\"total_tokens\": 10}}}\n\ndata: {\"event\": \"workflow_finished\", \"task_id\": \"task_abc\", \"workflow_run_id\": \"wf_run_1\", \"data\": {\"id\": \"wf_run_1\", \"workflow_id\": \"wf_def_xyz\", \"status\": \"succeeded\", \"elapsed_time\": 2.5, \"total_tokens\": 150, \"total_steps\": 3, \"created_at\": 1705395332, \"finished_at\": 1705395335}}\n\n"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequestGeneric"
          },
          "404": {
            "$ref": "#/components/responses/ConversationNotFound"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/files/upload": {
      "post": {
        "summary": "文件上传",
        "description": "上传文件以便在发送消息时使用，支持多模态理解。支持您的应用所支持的任何格式。上传的文件仅供当前终端用户使用。",
        "operationId": "uploadAdvancedChatFile",
        "tags": [
          "Files"
        ],
        "requestBody": {
          "description": "文件上传请求。需要 multipart/form-data 格式。",
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "file",
                  "user"
                ],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "要上传的文件。"
                  },
                  "user": {
                    "type": "string",
                    "description": "用户标识符，在应用内唯一。**注意**：Service API 不与 WebApp 共享会话。通过 API 创建的会话与在 WebApp 界面中创建的会话是隔离的。"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "文件上传成功。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileUploadResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequestFile"
          },
          "413": {
            "$ref": "#/components/responses/FileTooLarge"
          },
          "415": {
            "$ref": "#/components/responses/UnsupportedFileTypeFile"
          },
          "503": {
            "$ref": "#/components/responses/S3ErrorFile"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/files/{file_id}/preview": {
      "get": {
        "summary": "文件预览",
        "description": "预览或下载已上传的文件。此端点允许您访问之前通过文件上传 API 上传的文件。只有属于请求应用内消息的文件才能被访问。",
        "operationId": "previewChatFlowFile",
        "tags": [
          "Files"
        ],
        "parameters": [
          {
            "name": "file_id",
            "in": "path",
            "required": true,
            "description": "要预览的文件的唯一标识符，从文件上传 API 响应中获取。",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "as_attachment",
            "in": "query",
            "required": false,
            "description": "是否强制将文件作为附件下载。默认为 `false`（在浏览器中预览）。",
            "schema": {
              "type": "boolean",
              "default": false
            }
          }
        ],
        "responses": {
          "200": {
            "description": "文件内容返回成功。响应头根据文件类型和请求参数设置。",
            "content": {
              "image/png": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              },
              "image/jpeg": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              },
              "image/webp": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              },
              "image/gif": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              },
              "application/octet-stream": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            },
            "headers": {
              "Content-Type": {
                "description": "文件的 MIME 类型",
                "schema": {
                  "type": "string"
                }
              },
              "Content-Length": {
                "description": "文件大小（字节，如果可用）",
                "schema": {
                  "type": "integer"
                }
              },
              "Content-Disposition": {
                "description": "如果 as_attachment=true 则设置为 'attachment'",
                "schema": {
                  "type": "string"
                }
              },
              "Cache-Control": {
                "description": "用于性能优化的缓存头",
                "schema": {
                  "type": "string",
                  "example": "public, max-age=3600"
                }
              },
              "Accept-Ranges": {
                "description": "对于音频/视频文件设置为 'bytes'",
                "schema": {
                  "type": "string",
                  "example": "bytes"
                }
              }
            }
          },
          "400": {
            "description": "错误请求。可能的错误代码：\n- `invalid_param`：参数输入异常。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "禁止访问。可能的错误代码：\n- `file_access_denied`：文件访问被拒绝或文件不属于当前应用。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "未找到。可能的错误代码：\n- `file_not_found`：文件未找到或已被删除。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "内部服务器错误。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/chat-messages/{task_id}/stop": {
      "post": {
        "summary": "停止高级对话消息生成",
        "description": "停止高级对话消息生成任务。仅在流式模式下支持。",
        "operationId": "stopAdvancedChatMessageGeneration",
        "tags": [
          "Chatflow"
        ],
        "parameters": [
          {
            "name": "task_id",
            "in": "path",
            "required": true,
            "description": "来自流式块的任务 ID。",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "user"
                ],
                "properties": {
                  "user": {
                    "type": "string",
                    "description": "用户标识符，与发送消息调用保持一致。**注意**：Service API 不与 WebApp 共享会话。通过 API 创建的会话与在 WebApp 界面中创建的会话是隔离的。"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/SuccessResult"
          }
        }
      }
    },
    "/messages/{message_id}/feedbacks": {
      "post": {
        "summary": "消息反馈",
        "description": "对消息提供反馈。",
        "operationId": "postAdvancedChatMessageFeedback",
        "tags": [
          "Feedback"
        ],
        "parameters": [
          {
            "name": "message_id",
            "in": "path",
            "required": true,
            "description": "消息 ID。",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MessageFeedbackRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/SuccessResult"
          }
        }
      }
    },
    "/app/feedbacks": {
      "get": {
        "summary": "获取应用反馈",
        "description": "获取应用的反馈。",
        "operationId": "getAdvancedChatAppFeedbacks",
        "tags": [
          "Feedback"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageQueryParam"
          },
          {
            "$ref": "#/components/parameters/LimitQueryParam"
          }
        ],
        "responses": {
          "200": {
            "description": "应用反馈列表。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AppFeedbacksResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages/{message_id}/suggested": {
      "get": {
        "summary": "下一步问题建议",
        "description": "获取当前消息的下一步问题建议。",
        "operationId": "getAdvancedSuggestedQuestions",
        "tags": [
          "Chatflow"
        ],
        "parameters": [
          {
            "name": "message_id",
            "in": "path",
            "required": true,
            "description": "消息 ID。",
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/UserQueryParam"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取建议问题。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuggestedQuestionsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/messages": {
      "get": {
        "summary": "获取会话历史消息",
        "description": "以滚动加载格式返回历史聊天记录。",
        "operationId": "getAdvancedConversationHistory",
        "tags": [
          "Conversations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/ConversationIdQueryParam"
          },
          {
            "$ref": "#/components/parameters/UserQueryParam"
          },
          {
            "name": "first_id",
            "in": "query",
            "description": "当前页面第一条聊天记录的 ID（用于分页）。",
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/LimitQueryParamDefault20"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取会话历史。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversationHistoryResponse"
                }
              }
            }
          }
        }
      }
    },
    "/conversations": {
      "get": {
        "summary": "获取会话列表",
        "description": "获取当前用户的会话列表。",
        "operationId": "getAdvancedConversationsList",
        "tags": [
          "Conversations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/UserQueryParam"
          },
          {
            "$ref": "#/components/parameters/LastIdQueryParam"
          },
          {
            "$ref": "#/components/parameters/LimitQueryParamDefault20Max100"
          },
          {
            "$ref": "#/components/parameters/SortByQueryParam"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取会话列表。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversationsListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/conversations/{conversation_id}": {
      "delete": {
        "summary": "删除会话",
        "description": "删除会话。",
        "operationId": "deleteAdvancedConversation",
        "tags": [
          "Conversations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/ConversationIdPathParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "user"
                ],
                "properties": {
                  "user": {
                    "type": "string",
                    "description": "用户标识符。**注意**：Service API 不与 WebApp 共享会话。通过 API 创建的会话与在 WebApp 界面中创建的会话是隔离的。"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "会话删除成功。无内容。"
          }
        }
      }
    },
    "/conversations/{conversation_id}/name": {
      "post": {
        "summary": "会话重命名",
        "description": "重命名会话。",
        "operationId": "renameAdvancedConversation",
        "tags": [
          "Conversations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/ConversationIdPathParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConversationRenameRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "会话重命名成功。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversationRenameResponse"
                }
              }
            }
          }
        }
      }
    },
    "/conversations/{conversation_id}/variables": {
      "get": {
        "summary": "获取会话变量",
        "description": "从特定会话中获取变量。",
        "operationId": "getAdvancedConversationVariables",
        "tags": [
          "Conversations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/ConversationIdPathParam"
          },
          {
            "$ref": "#/components/parameters/UserQueryParam"
          },
          {
            "$ref": "#/components/parameters/LastIdQueryParam"
          },
          {
            "$ref": "#/components/parameters/LimitQueryParamDefault20Max100"
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取会话变量。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConversationVariablesResponse"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/ConversationNotFound"
          }
        }
      }
    },
    "/audio-to-text": {
      "post": {
        "summary": "语音转文字",
        "description": "将音频文件转换为文字。支持的格式：mp3、mp4、mpeg、mpga、m4a、wav、webm。文件大小限制：15MB。",
        "operationId": "advancedAudioToText",
        "tags": [
          "TTS"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/AudioToTextRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "音频转文字成功。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AudioToTextResponse"
                }
              }
            }
          }
        }
      }
    },
    "/text-to-audio": {
      "post": {
        "summary": "文字转语音",
        "description": "将文字转换为语音。",
        "operationId": "advancedTextToAudio",
        "tags": [
          "TTS"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TextToAudioJsonRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "音频文件生成成功。",
            "content": {
              "audio/wav": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              },
              "audio/mp3": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            },
            "headers": {
              "Content-Type": {
                "schema": {
                  "type": "string",
                  "example": "audio/wav"
                }
              }
            }
          }
        }
      }
    },
    "/info": {
      "get": {
        "summary": "获取应用基本信息",
        "operationId": "getAdvancedChatAppInfo",
        "tags": [
          "Application"
        ],
        "responses": {
          "200": {
            "description": "应用基本信息。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AppInfoResponse"
                }
              }
            }
          }
        }
      }
    },
    "/parameters": {
      "get": {
        "summary": "获取应用参数信息",
        "operationId": "getAdvancedChatAppParameters",
        "tags": [
          "Application"
        ],
        "responses": {
          "200": {
            "description": "应用参数。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatAppParametersResponse"
                }
              }
            }
          }
        }
      }
    },
    "/meta": {
      "get": {
        "summary": "获取应用元信息",
        "operationId": "getAdvancedChatAppMeta",
        "tags": [
          "Application"
        ],
        "responses": {
          "200": {
            "description": "应用元信息（工具图标）。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AppMetaResponse"
                }
              }
            }
          }
        }
      }
    },
    "/site": {
      "get": {
        "summary": "获取应用 WebApp 设置",
        "operationId": "getAdvancedChatWebAppSettings",
        "tags": [
          "Application"
        ],
        "responses": {
          "200": {
            "description": "WebApp 设置。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WebAppSettingsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/apps/annotations": {
      "get": {
        "summary": "获取标注列表",
        "operationId": "getAdvancedAnnotationList",
        "tags": [
          "Annotations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageQueryParam"
          },
          {
            "$ref": "#/components/parameters/LimitQueryParamDefault20Max100"
          }
        ],
        "responses": {
          "200": {
            "description": "标注列表。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnnotationListResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "创建标注",
        "operationId": "createAdvancedAnnotation",
        "tags": [
          "Annotations"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateAnnotationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "标注已创建。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnnotationItem"
                }
              }
            }
          },
          "201": {
            "description": "标注已创建。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnnotationItem"
                }
              }
            }
          }
        }
      }
    },
    "/apps/annotations/{annotation_id}": {
      "put": {
        "summary": "更新标注",
        "operationId": "updateAdvancedAnnotation",
        "tags": [
          "Annotations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AnnotationIdPathParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateAnnotationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "标注已更新。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnnotationItem"
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "删除标注",
        "operationId": "deleteAdvancedAnnotation",
        "tags": [
          "Annotations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AnnotationIdPathParam"
          }
        ],
        "responses": {
          "204": {
            "description": "标注已删除。"
          }
        }
      }
    },
    "/apps/annotation-reply/{action}": {
      "post": {
        "summary": "初始化标注回复设置",
        "operationId": "initialAdvancedAnnotationReplySettings",
        "tags": [
          "Annotations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AnnotationActionPathParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InitialAnnotationReplySettingsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "任务已启动。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InitialAnnotationReplySettingsResponse"
                }
              }
            }
          },
          "202": {
            "description": "任务已接受。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InitialAnnotationReplySettingsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/apps/annotation-reply/{action}/status/{job_id}": {
      "get": {
        "summary": "查询初始化标注回复设置任务状态",
        "operationId": "getAdvancedInitialAnnotationReplySettingsStatus",
        "tags": [
          "Annotations"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/AnnotationActionPathParam"
          },
          {
            "$ref": "#/components/parameters/JobIdPathParam"
          }
        ],
        "responses": {
          "200": {
            "description": "任务状态。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InitialAnnotationReplySettingsStatusResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "API_KEY",
        "description": "API Key 认证。"
      }
    },
    "parameters": {
      "PageQueryParam": {
        "name": "page",
        "in": "query",
        "description": "页码。",
        "schema": {
          "type": "integer",
          "default": 1
        }
      },
      "LimitQueryParam": {
        "name": "limit",
        "in": "query",
        "description": "每页条目数。",
        "schema": {
          "type": "integer"
        }
      },
      "LimitQueryParamDefault20": {
        "name": "limit",
        "in": "query",
        "description": "每页条目数。",
        "schema": {
          "type": "integer",
          "default": 20
        }
      },
      "LimitQueryParamDefault20Max100": {
        "name": "limit",
        "in": "query",
        "description": "每页条目数（默认 20，最大 100）。",
        "schema": {
          "type": "integer",
          "default": 20,
          "minimum": 1,
          "maximum": 100
        }
      },
      "UserQueryParam": {
        "name": "user",
        "in": "query",
        "required": true,
        "description": "用户标识符。**注意**：Service API 不与 WebApp 共享会话。通过 API 创建的会话与在 WebApp 界面中创建的会话是隔离的。",
        "schema": {
          "type": "string"
        }
      },
      "ConversationIdQueryParam": {
        "name": "conversation_id",
        "in": "query",
        "required": true,
        "description": "会话 ID。",
        "schema": {
          "type": "string"
        }
      },
      "LastIdQueryParam": {
        "name": "last_id",
        "in": "query",
        "description": "用于分页的最后一条记录的 ID。",
        "schema": {
          "type": "string"
        }
      },
      "SortByQueryParam": {
        "name": "sort_by",
        "in": "query",
        "description": "排序字段（例如，-updated_at）。",
        "schema": {
          "type": "string",
          "enum": [
            "created_at",
            "-created_at",
            "updated_at",
            "-updated_at"
          ],
          "default": "-updated_at"
        }
      },
      "ConversationIdPathParam": {
        "name": "conversation_id",
        "in": "path",
        "required": true,
        "description": "会话 ID。",
        "schema": {
          "type": "string"
        }
      },
      "AnnotationIdPathParam": {
        "name": "annotation_id",
        "in": "path",
        "required": true,
        "description": "标注 ID。",
        "schema": {
          "type": "string",
          "format": "uuid"
        }
      },
      "AnnotationActionPathParam": {
        "name": "action",
        "in": "path",
        "required": true,
        "description": "操作：'enable' 或 'disable'。",
        "schema": {
          "type": "string",
          "enum": [
            "enable",
            "disable"
          ]
        }
      },
      "JobIdPathParam": {
        "name": "job_id",
        "in": "path",
        "required": true,
        "description": "任务 ID。",
        "schema": {
          "type": "string",
          "format": "uuid"
        }
      }
    },
    "responses": {
      "BadRequestGeneric": {
        "description": "错误请求。请检查参数。",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "BadRequestFile": {
        "description": "文件操作的错误请求。",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "FileTooLarge": {
        "description": "文件过大。",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "UnsupportedFileTypeFile": {
        "description": "不支持上传的文件类型。",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "S3ErrorFile": {
        "description": "S3 存储错误。",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "InternalServerError": {
        "description": "内部服务器错误。",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      },
      "SuccessResult": {
        "description": "操作成功。",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "result": {
                  "type": "string",
                  "example": "success"
                }
              }
            }
          }
        }
      },
      "ConversationNotFound": {
        "description": "会话未找到。",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          }
        }
      }
    },
    "schemas": {
      "AdvancedChatRequest": {
        "type": "object",
        "required": [
          "query",
          "user"
        ],
        "properties": {
          "query": {
            "type": "string",
            "description": "用户输入/问题内容。"
          },
          "inputs": {
            "type": "object",
            "description": "应用变量的键值对。对于文件类型变量，值应为 InputFileObject。",
            "additionalProperties": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "number"
                },
                {
                  "type": "boolean"
                },
                {
                  "$ref": "#/components/schemas/InputFileObjectAdvanced"
                }
              ]
            },
            "default": {}
          },
          "response_mode": {
            "type": "string",
            "enum": [
              "streaming",
              "blocking"
            ],
            "default": "streaming",
            "description": "响应模式。Cloudflare 对阻塞模式的超时时间为 100 秒。"
          },
          "user": {
            "type": "string",
            "description": "用户标识符。**注意**：Service API 不与 WebApp 共享会话。通过 API 创建的会话与在 WebApp 界面中创建的会话是隔离的。"
          },
          "conversation_id": {
            "type": "string",
            "description": "要继续的会话 ID。"
          },
          "files": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InputFileObjectAdvanced"
            },
            "description": "用于支持视觉功能的模型或通用文件输入的文件列表。"
          },
          "auto_generate_name": {
            "type": "boolean",
            "default": true,
            "description": "自动生成会话标题。"
          }
        }
      },
      "InputFileObjectAdvanced": {
        "type": "object",
        "required": [
          "type",
          "transfer_method"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "document",
              "image",
              "audio",
              "video",
              "custom"
            ],
            "description": "文件类型。'document' 涵盖 TXT、MD、PDF、HTML、XLSX、DOCX、CSV、EML、MSG、PPTX、XML、EPUB。'image' 涵盖 JPG、PNG、GIF、WEBP、SVG。'audio' 涵盖 MP3、M4A、WAV、WEBM、AMR。'video' 涵盖 MP4、MOV、MPEG、MPGA。"
          },
          "transfer_method": {
            "type": "string",
            "enum": [
              "remote_url",
              "local_file"
            ],
            "description": "传输方式，`remote_url` 表示文件 URL / `local_file` 表示文件上传"
          },
          "url": {
            "type": "string",
            "format": "url",
            "description": "文件 URL（当传输方式为 `remote_url` 时）"
          },
          "upload_file_id": {
            "type": "string",
            "description": "已上传文件的 ID，必须通过文件上传 API 预先上传获取（当传输方式为 `local_file` 时）"
          }
        },
        "anyOf": [
          {
            "properties": {
              "transfer_method": {
                "enum": [
                  "remote_url"
                ]
              },
              "url": {
                "type": "string",
                "format": "url"
              }
            },
            "required": [
              "url"
            ],
            "not": {
              "required": [
                "upload_file_id"
              ]
            }
          },
          {
            "properties": {
              "transfer_method": {
                "enum": [
                  "local_file"
                ]
              },
              "upload_file_id": {
                "type": "string"
              }
            },
            "required": [
              "upload_file_id"
            ],
            "not": {
              "required": [
                "url"
              ]
            }
          }
        ],
        "example": {
          "type": "image",
          "transfer_method": "remote_url",
          "url": "https://example.com/image.png"
        }
      },
      "ChatCompletionResponse": {
        "type": "object",
        "description": "阻塞模式对话的响应。",
        "properties": {
          "event": {
            "type": "string",
            "example": "message"
          },
          "task_id": {
            "type": "string",
            "format": "uuid"
          },
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "此响应事件的唯一 ID。"
          },
          "message_id": {
            "type": "string",
            "format": "uuid"
          },
          "conversation_id": {
            "type": "string",
            "format": "uuid"
          },
          "mode": {
            "type": "string",
            "example": "chat"
          },
          "answer": {
            "type": "string"
          },
          "metadata": {
            "$ref": "#/components/schemas/ResponseMetadata"
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "ResponseMetadata": {
        "type": "object",
        "properties": {
          "usage": {
            "$ref": "#/components/schemas/Usage"
          },
          "retriever_resources": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RetrieverResource"
            }
          }
        }
      },
      "ChunkAdvancedChatEvent": {
        "type": "object",
        "required": [
          "event"
        ],
        "properties": {
          "event": {
            "type": "string",
            "enum": [
              "message",
              "message_file",
              "message_end",
              "tts_message",
              "tts_message_end",
              "message_replace",
              "workflow_started",
              "node_started",
              "node_finished",
              "workflow_finished",
              "error",
              "ping"
            ]
          }
        },
        "discriminator": {
          "propertyName": "event",
          "mapping": {
            "message": "#/components/schemas/StreamEventAdvChatMessage",
            "message_file": "#/components/schemas/StreamEventAdvMessageFile",
            "message_end": "#/components/schemas/StreamEventAdvMessageEnd",
            "tts_message": "#/components/schemas/StreamEventAdvTtsMessage",
            "tts_message_end": "#/components/schemas/StreamEventAdvTtsMessageEnd",
            "message_replace": "#/components/schemas/StreamEventAdvMessageReplace",
            "workflow_started": "#/components/schemas/StreamEventAdvWorkflowStarted",
            "node_started": "#/components/schemas/StreamEventAdvNodeStarted",
            "node_finished": "#/components/schemas/StreamEventAdvNodeFinished",
            "workflow_finished": "#/components/schemas/StreamEventAdvWorkflowFinished",
            "error": "#/components/schemas/StreamEventAdvError",
            "ping": "#/components/schemas/StreamEventAdvPing"
          }
        }
      },
      "StreamEventBaseAdv": {
        "type": "object",
        "properties": {
          "task_id": {
            "type": "string",
            "format": "uuid"
          },
          "message_id": {
            "type": "string",
            "format": "uuid"
          },
          "conversation_id": {
            "type": "string",
            "format": "uuid"
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "StreamEventAdvChatMessage": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "$ref": "#/components/schemas/StreamEventBaseAdv"
          },
          {
            "type": "object",
            "required": [
              "answer"
            ],
            "properties": {
              "answer": {
                "type": "string"
              }
            }
          }
        ]
      },
      "StreamEventAdvMessageFile": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "type": "object",
            "required": [
              "id",
              "type",
              "belongs_to",
              "url",
              "conversation_id"
            ],
            "properties": {
              "id": {
                "type": "string",
                "format": "uuid"
              },
              "type": {
                "type": "string",
                "description": "文件类型，例如 'image'。"
              },
              "belongs_to": {
                "type": "string",
                "enum": [
                  "assistant"
                ]
              },
              "url": {
                "type": "string",
                "format": "url"
              },
              "conversation_id": {
                "type": "string",
                "format": "uuid"
              }
            }
          }
        ]
      },
      "StreamEventAdvMessageEnd": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "$ref": "#/components/schemas/StreamEventBaseAdv"
          },
          {
            "type": "object",
            "required": [
              "metadata"
            ],
            "properties": {
              "metadata": {
                "$ref": "#/components/schemas/ResponseMetadata"
              }
            }
          }
        ]
      },
      "StreamEventAdvTtsMessage": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "$ref": "#/components/schemas/StreamEventBaseAdv"
          },
          {
            "type": "object",
            "required": [
              "audio"
            ],
            "properties": {
              "audio": {
                "type": "string",
                "format": "byte",
                "description": "Base64 编码的音频。"
              }
            }
          }
        ]
      },
      "StreamEventAdvTtsMessageEnd": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "$ref": "#/components/schemas/StreamEventBaseAdv"
          },
          {
            "type": "object",
            "required": [
              "audio"
            ],
            "properties": {
              "audio": {
                "type": "string",
                "description": "空字符串。"
              }
            }
          }
        ]
      },
      "StreamEventAdvMessageReplace": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "$ref": "#/components/schemas/StreamEventBaseAdv"
          },
          {
            "type": "object",
            "required": [
              "answer"
            ],
            "properties": {
              "answer": {
                "type": "string",
                "description": "替换内容。"
              }
            }
          }
        ]
      },
      "StreamEventAdvWorkflowStarted": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "type": "object",
            "required": [
              "task_id",
              "workflow_run_id",
              "data"
            ],
            "properties": {
              "task_id": {
                "type": "string",
                "format": "uuid"
              },
              "workflow_run_id": {
                "type": "string",
                "format": "uuid"
              },
              "data": {
                "$ref": "#/components/schemas/WorkflowStartedData"
              }
            }
          }
        ]
      },
      "WorkflowStartedData": {
        "type": "object",
        "required": [
          "id",
          "workflow_id",
          "sequence_number",
          "created_at"
        ],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "workflow_id": {
            "type": "string",
            "format": "uuid"
          },
          "sequence_number": {
            "type": "integer"
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "StreamEventAdvNodeStarted": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "type": "object",
            "required": [
              "task_id",
              "workflow_run_id",
              "data"
            ],
            "properties": {
              "task_id": {
                "type": "string",
                "format": "uuid"
              },
              "workflow_run_id": {
                "type": "string",
                "format": "uuid"
              },
              "data": {
                "$ref": "#/components/schemas/NodeStartedData"
              }
            }
          }
        ]
      },
      "NodeStartedData": {
        "type": "object",
        "required": [
          "id",
          "node_id",
          "node_type",
          "title",
          "index",
          "created_at"
        ],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "此节点执行实例的唯一 ID。"
          },
          "node_id": {
            "type": "string",
            "format": "uuid",
            "description": "节点定义的 ID。"
          },
          "node_type": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "index": {
            "type": "integer"
          },
          "predecessor_node_id": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "inputs": {
            "type": "object",
            "additionalProperties": true,
            "description": "节点使用的变量。"
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "StreamEventAdvNodeFinished": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "type": "object",
            "required": [
              "task_id",
              "workflow_run_id",
              "data"
            ],
            "properties": {
              "task_id": {
                "type": "string",
                "format": "uuid"
              },
              "workflow_run_id": {
                "type": "string",
                "format": "uuid"
              },
              "data": {
                "$ref": "#/components/schemas/NodeFinishedData"
              }
            }
          }
        ]
      },
      "NodeFinishedData": {
        "type": "object",
        "required": [
          "id",
          "node_id",
          "node_type",
          "title",
          "index",
          "status",
          "created_at"
        ],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "node_id": {
            "type": "string",
            "format": "uuid"
          },
          "node_type": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "index": {
            "type": "integer"
          },
          "predecessor_node_id": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "inputs": {
            "type": "object",
            "additionalProperties": true,
            "nullable": true
          },
          "process_data": {
            "type": "object",
            "additionalProperties": true,
            "nullable": true,
            "description": "节点处理数据（JSON）。"
          },
          "outputs": {
            "type": "object",
            "additionalProperties": true,
            "nullable": true,
            "description": "输出内容（JSON）。"
          },
          "status": {
            "type": "string",
            "enum": [
              "running",
              "succeeded",
              "failed",
              "stopped"
            ]
          },
          "error": {
            "type": "string",
            "nullable": true
          },
          "elapsed_time": {
            "type": "number",
            "format": "float",
            "nullable": true
          },
          "execution_metadata": {
            "$ref": "#/components/schemas/NodeExecutionMetadata",
            "nullable": true
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "NodeExecutionMetadata": {
        "type": "object",
        "properties": {
          "total_tokens": {
            "type": "integer",
            "nullable": true
          },
          "total_price": {
            "type": "number",
            "format": "float",
            "nullable": true,
            "description": "使用浮点数表示价格以保证兼容性，MD 文档中说明为 decimal。"
          },
          "currency": {
            "type": "string",
            "nullable": true,
            "example": "USD"
          }
        }
      },
      "StreamEventAdvWorkflowFinished": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "type": "object",
            "required": [
              "task_id",
              "workflow_run_id",
              "data"
            ],
            "properties": {
              "task_id": {
                "type": "string",
                "format": "uuid"
              },
              "workflow_run_id": {
                "type": "string",
                "format": "uuid"
              },
              "data": {
                "$ref": "#/components/schemas/WorkflowFinishedData"
              }
            }
          }
        ]
      },
      "WorkflowFinishedData": {
        "type": "object",
        "required": [
          "id",
          "workflow_id",
          "status",
          "created_at",
          "finished_at"
        ],
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "workflow_id": {
            "type": "string",
            "format": "uuid"
          },
          "status": {
            "type": "string",
            "enum": [
              "running",
              "succeeded",
              "failed",
              "stopped"
            ]
          },
          "outputs": {
            "type": "object",
            "additionalProperties": true,
            "nullable": true,
            "description": "输出内容（JSON）。"
          },
          "error": {
            "type": "string",
            "nullable": true
          },
          "elapsed_time": {
            "type": "number",
            "format": "float",
            "nullable": true
          },
          "total_tokens": {
            "type": "integer",
            "nullable": true
          },
          "total_steps": {
            "type": "integer",
            "default": 0
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          },
          "finished_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "StreamEventAdvError": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "type": "object",
            "required": [
              "task_id",
              "status",
              "code",
              "message"
            ],
            "properties": {
              "task_id": {
                "type": "string",
                "format": "uuid"
              },
              "message_id": {
                "type": "string",
                "format": "uuid",
                "nullable": true,
                "description": "在通用错误中可能不总是存在。"
              },
              "status": {
                "type": "integer"
              },
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            }
          }
        ]
      },
      "StreamEventAdvPing": {
        "allOf": [
          {
            "$ref": "#/components/schemas/ChunkAdvancedChatEvent"
          },
          {
            "type": "object"
          }
        ]
      },
      "Usage": {
        "type": "object",
        "properties": {
          "prompt_tokens": {
            "type": "integer"
          },
          "prompt_unit_price": {
            "type": "string"
          },
          "prompt_price_unit": {
            "type": "string"
          },
          "prompt_price": {
            "type": "string"
          },
          "completion_tokens": {
            "type": "integer"
          },
          "completion_unit_price": {
            "type": "string"
          },
          "completion_price_unit": {
            "type": "string"
          },
          "completion_price": {
            "type": "string"
          },
          "total_tokens": {
            "type": "integer"
          },
          "total_price": {
            "type": "string"
          },
          "currency": {
            "type": "string"
          },
          "latency": {
            "type": "number",
            "format": "double"
          }
        }
      },
      "RetrieverResource": {
        "type": "object",
        "properties": {
          "position": {
            "type": "integer"
          },
          "dataset_id": {
            "type": "string",
            "format": "uuid"
          },
          "dataset_name": {
            "type": "string"
          },
          "document_id": {
            "type": "string",
            "format": "uuid"
          },
          "document_name": {
            "type": "string"
          },
          "segment_id": {
            "type": "string",
            "format": "uuid"
          },
          "score": {
            "type": "number",
            "format": "float"
          },
          "content": {
            "type": "string"
          }
        }
      },
      "FileUploadResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "size": {
            "type": "integer"
          },
          "extension": {
            "type": "string"
          },
          "mime_type": {
            "type": "string"
          },
          "created_by": {
            "type": "string",
            "format": "uuid"
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "MessageFeedbackRequest": {
        "type": "object",
        "required": [
          "user"
        ],
        "properties": {
          "rating": {
            "type": "string",
            "enum": [
              "like",
              "dislike",
              null
            ],
            "nullable": true
          },
          "user": {
            "type": "string"
          },
          "content": {
            "type": "string",
            "nullable": true
          }
        }
      },
      "AppFeedbacksResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FeedbackItem"
            }
          }
        }
      },
      "FeedbackItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "app_id": {
            "type": "string",
            "format": "uuid"
          },
          "conversation_id": {
            "type": "string",
            "format": "uuid"
          },
          "message_id": {
            "type": "string",
            "format": "uuid"
          },
          "rating": {
            "type": "string",
            "enum": [
              "like",
              "dislike",
              null
            ],
            "nullable": true
          },
          "content": {
            "type": "string"
          },
          "from_source": {
            "type": "string"
          },
          "from_end_user_id": {
            "type": "string",
            "format": "uuid"
          },
          "from_account_id": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SuggestedQuestionsResponse": {
        "type": "object",
        "properties": {
          "result": {
            "type": "string",
            "example": "success"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ConversationHistoryResponse": {
        "type": "object",
        "properties": {
          "limit": {
            "type": "integer"
          },
          "has_more": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ConversationMessageItem"
            }
          }
        }
      },
      "ConversationMessageItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "conversation_id": {
            "type": "string",
            "format": "uuid"
          },
          "inputs": {
            "type": "object",
            "additionalProperties": true
          },
          "query": {
            "type": "string"
          },
          "answer": {
            "type": "string"
          },
          "message_files": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/MessageFileItem"
            }
          },
          "feedback": {
            "type": "object",
            "nullable": true,
            "properties": {
              "rating": {
                "type": "string",
                "enum": [
                  "like",
                  "dislike"
                ]
              }
            }
          },
          "retriever_resources": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RetrieverResource"
            }
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "MessageFileItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "type": {
            "type": "string"
          },
          "url": {
            "type": "string",
            "format": "url"
          },
          "belongs_to": {
            "type": "string",
            "enum": [
              "user",
              "assistant"
            ]
          }
        }
      },
      "ConversationsListResponse": {
        "type": "object",
        "properties": {
          "limit": {
            "type": "integer"
          },
          "has_more": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ConversationListItem"
            }
          }
        }
      },
      "ConversationListItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "inputs": {
            "type": "object",
            "additionalProperties": true
          },
          "status": {
            "type": "string"
          },
          "introduction": {
            "type": "string",
            "nullable": true
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          },
          "updated_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "ConversationRenameRequest": {
        "type": "object",
        "required": [
          "user"
        ],
        "properties": {
          "name": {
            "type": "string",
            "nullable": true
          },
          "auto_generate": {
            "type": "boolean",
            "default": false
          },
          "user": {
            "type": "string"
          }
        }
      },
      "ConversationRenameResponse": {
        "$ref": "#/components/schemas/ConversationListItem"
      },
      "ConversationVariablesResponse": {
        "type": "object",
        "properties": {
          "limit": {
            "type": "integer"
          },
          "has_more": {
            "type": "boolean"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ConversationVariableItem"
            }
          }
        }
      },
      "ConversationVariableItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "value_type": {
            "type": "string"
          },
          "value": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          },
          "updated_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "AudioToTextRequest": {
        "type": "object",
        "required": [
          "file",
          "user"
        ],
        "properties": {
          "file": {
            "type": "string",
            "format": "binary",
            "description": "音频文件。格式：mp3、mp4、mpeg、mpga、m4a、wav、webm。限制：15MB。"
          },
          "user": {
            "type": "string"
          }
        }
      },
      "AudioToTextResponse": {
        "type": "object",
        "properties": {
          "text": {
            "type": "string"
          }
        }
      },
      "TextToAudioJsonRequest": {
        "type": "object",
        "required": [
          "user"
        ],
        "properties": {
          "message_id": {
            "type": "string",
            "format": "uuid",
            "description": "消息 ID（优先）。"
          },
          "text": {
            "type": "string",
            "description": "语音内容。"
          },
          "user": {
            "type": "string"
          },
          "streaming": {
            "type": "boolean",
            "default": false,
            "description": "如果为 true，响应将是音频块的流。"
          }
        },
        "description": "需要 `user`。提供 `message_id` 或 `text`。"
      },
      "AppInfoResponse": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ChatAppParametersResponse": {
        "type": "object",
        "properties": {
          "opening_statement": {
            "type": "string"
          },
          "suggested_questions": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "suggested_questions_after_answer": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean"
              }
            }
          },
          "speech_to_text": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean"
              }
            }
          },
          "text_to_speech": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean"
              },
              "voice": {
                "type": "string"
              },
              "language": {
                "type": "string"
              },
              "autoPlay": {
                "type": "string",
                "enum": [
                  "enabled",
                  "disabled"
                ]
              }
            }
          },
          "retriever_resource": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean"
              }
            }
          },
          "annotation_reply": {
            "type": "object",
            "properties": {
              "enabled": {
                "type": "boolean"
              }
            }
          },
          "user_input_form": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UserInputFormItem"
            }
          },
          "file_upload": {
            "type": "object",
            "properties": {
              "image": {
                "type": "object",
                "properties": {
                  "enabled": {
                    "type": "boolean"
                  },
                  "number_limits": {
                    "type": "integer"
                  },
                  "detail": {
                    "type": "string"
                  },
                  "transfer_methods": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": [
                        "remote_url",
                        "local_file"
                      ]
                    }
                  }
                }
              }
            }
          },
          "system_parameters": {
            "type": "object",
            "properties": {
              "file_size_limit": {
                "type": "integer"
              },
              "image_file_size_limit": {
                "type": "integer"
              },
              "audio_file_size_limit": {
                "type": "integer"
              },
              "video_file_size_limit": {
                "type": "integer"
              }
            }
          }
        }
      },
      "UserInputFormItem": {
        "type": "object",
        "oneOf": [
          {
            "$ref": "#/components/schemas/TextInputControlWrapper"
          },
          {
            "$ref": "#/components/schemas/ParagraphControlWrapper"
          },
          {
            "$ref": "#/components/schemas/SelectControlWrapper"
          }
        ]
      },
      "TextInputControlWrapper": {
        "type": "object",
        "properties": {
          "text-input": {
            "$ref": "#/components/schemas/TextInputControl"
          }
        },
        "required": [
          "text-input"
        ]
      },
      "ParagraphControlWrapper": {
        "type": "object",
        "properties": {
          "paragraph": {
            "$ref": "#/components/schemas/ParagraphControl"
          }
        },
        "required": [
          "paragraph"
        ]
      },
      "SelectControlWrapper": {
        "type": "object",
        "properties": {
          "select": {
            "$ref": "#/components/schemas/SelectControl"
          }
        },
        "required": [
          "select"
        ]
      },
      "TextInputControl": {
        "type": "object",
        "required": [
          "label",
          "variable",
          "required"
        ],
        "properties": {
          "label": {
            "type": "string"
          },
          "variable": {
            "type": "string"
          },
          "required": {
            "type": "boolean"
          },
          "default": {
            "type": "string"
          }
        }
      },
      "ParagraphControl": {
        "type": "object",
        "required": [
          "label",
          "variable",
          "required"
        ],
        "properties": {
          "label": {
            "type": "string"
          },
          "variable": {
            "type": "string"
          },
          "required": {
            "type": "boolean"
          },
          "default": {
            "type": "string"
          }
        }
      },
      "SelectControl": {
        "type": "object",
        "required": [
          "label",
          "variable",
          "required",
          "options"
        ],
        "properties": {
          "label": {
            "type": "string"
          },
          "variable": {
            "type": "string"
          },
          "required": {
            "type": "boolean"
          },
          "default": {
            "type": "string"
          },
          "options": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "AppMetaResponse": {
        "type": "object",
        "properties": {
          "tool_icons": {
            "type": "object",
            "additionalProperties": {
              "oneOf": [
                {
                  "type": "string",
                  "format": "url"
                },
                {
                  "$ref": "#/components/schemas/ToolIconDetail"
                }
              ]
            }
          }
        }
      },
      "ToolIconDetail": {
        "type": "object",
        "properties": {
          "background": {
            "type": "string"
          },
          "content": {
            "type": "string"
          }
        }
      },
      "WebAppSettingsResponse": {
        "type": "object",
        "properties": {
          "title": {
            "type": "string"
          },
          "chat_color_theme": {
            "type": "string"
          },
          "chat_color_theme_inverted": {
            "type": "boolean"
          },
          "icon_type": {
            "type": "string",
            "enum": [
              "emoji",
              "image"
            ]
          },
          "icon": {
            "type": "string"
          },
          "icon_background": {
            "type": "string"
          },
          "icon_url": {
            "type": "string",
            "format": "url",
            "nullable": true
          },
          "description": {
            "type": "string"
          },
          "copyright": {
            "type": "string"
          },
          "privacy_policy": {
            "type": "string"
          },
          "custom_disclaimer": {
            "type": "string"
          },
          "default_language": {
            "type": "string"
          },
          "show_workflow_steps": {
            "type": "boolean"
          },
          "use_icon_as_answer_icon": {
            "type": "boolean"
          }
        }
      },
      "AnnotationListResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AnnotationItem"
            }
          },
          "has_more": {
            "type": "boolean"
          },
          "limit": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "page": {
            "type": "integer"
          }
        }
      },
      "AnnotationItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "question": {
            "type": "string"
          },
          "answer": {
            "type": "string"
          },
          "hit_count": {
            "type": "integer"
          },
          "created_at": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "CreateAnnotationRequest": {
        "type": "object",
        "required": [
          "question",
          "answer"
        ],
        "properties": {
          "question": {
            "type": "string"
          },
          "answer": {
            "type": "string"
          }
        }
      },
      "UpdateAnnotationRequest": {
        "type": "object",
        "required": [
          "question",
          "answer"
        ],
        "properties": {
          "question": {
            "type": "string"
          },
          "answer": {
            "type": "string"
          }
        }
      },
      "InitialAnnotationReplySettingsRequest": {
        "type": "object",
        "required": [
          "score_threshold"
        ],
        "properties": {
          "embedding_provider_name": {
            "type": "string",
            "nullable": true
          },
          "embedding_model_name": {
            "type": "string",
            "nullable": true
          },
          "score_threshold": {
            "type": "number",
            "format": "float"
          }
        }
      },
      "InitialAnnotationReplySettingsResponse": {
        "type": "object",
        "properties": {
          "job_id": {
            "type": "string",
            "format": "uuid"
          },
          "job_status": {
            "type": "string"
          }
        }
      },
      "InitialAnnotationReplySettingsStatusResponse": {
        "type": "object",
        "properties": {
          "job_id": {
            "type": "string",
            "format": "uuid"
          },
          "job_status": {
            "type": "string"
          },
          "error_msg": {
            "type": "string",
            "nullable": true
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "integer",
            "nullable": true
          },
          "code": {
            "type": "string",
            "nullable": true
          },
          "message": {
            "type": "string"
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Chatflow",
      "description": "带工作流事件的高级对话操作。"
    },
    {
      "name": "Files",
      "description": "高级对话的文件上传和预览操作。"
    },
    {
      "name": "Feedback",
      "description": "高级对话的用户反馈操作。"
    },
    {
      "name": "Conversations",
      "description": "高级对话的会话管理。"
    },
    {
      "name": "TTS",
      "description": "高级对话的语音和文字转换。"
    },
    {
      "name": "Application",
      "description": "高级对话的应用设置和信息。"
    },
    {
      "name": "Annotations",
      "description": "高级对话的标注管理。"
    }
  ]
}