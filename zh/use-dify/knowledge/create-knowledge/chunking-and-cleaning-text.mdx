---
title: 配置分段设置
---

<Note> ⚠️ 本文档由 AI 自动翻译。如有任何不准确之处，请参考[英文原版](/en/use-dify/knowledge/create-knowledge/chunking-and-cleaning-text)。</Note>

## 什么是分段？

导入知识库的文档会被拆分为更小的片段，称为**分段**。分段就像将一本大书组织成章节和段落一样——你无法在一大块文本中快速找到特定信息，但组织良好的章节能让检索变得高效。

当用户提问时，系统会在这些分段中搜索相关信息，并将其作为上下文提供给 LLM。如果没有分段，每次查询都要处理整个文档，这将是缓慢且低效的。

**关键分段参数**

- **分隔符**：文本被拆分的字符或字符序列。例如，`\n\n` 在段落处分隔，`\n` 在换行处分隔。

  <Note>
    分隔符在分段过程中会被移除。例如，使用 `A` 作为分隔符会将 `CBACD` 拆分为 `CB` 和 `CD`。
    
    为避免信息丢失，请使用文档中不会自然出现的非内容字符。
  </Note>

- **分段最大长度**：每个分段的最大字符数。超过此限制的文本将被强制拆分，无论分隔符设置如何。

## 选择分段模式

<Note>
    知识库创建后无法更改分段模式。但是，分隔符和分段最大长度等分段设置可以随时调整。
</Note>

### 模式概述

<Tabs>
  <Tab title="通用模式">

    在通用模式下，所有分段共享相同的设置。匹配的分段会直接作为检索结果返回。

    **分段设置**

    除了分隔符和分段最大长度外，你还可以配置**分段重叠长度**来指定相邻分段之间重叠的字符数。这有助于保持语义连贯性，防止重要信息被拆分到不同分段的边界处。

    例如，设置 50 个字符的重叠时，一个分段的最后 50 个字符也会作为下一个分段的前 50 个字符出现。
    
  </Tab>
    <Tab title="父子模式">

      在父子模式下，文本被拆分为两层：较小的**子分段**和较大的**父分段**。当查询匹配到子分段时，其整个父分段会作为检索结果返回。

      这解决了一个常见的检索困境：较小的分段能够精确匹配查询但缺乏上下文，而较大的分段提供丰富的上下文但会降低检索准确性。

      父子模式兼顾两者——以精确度检索，以上下文响应。

      **父分段设置**

      父分段可以通过**段落**或**全文**模式创建。

      <Tabs>
        <Tab title="段落">
          文档根据指定的分隔符和分段最大长度被拆分为多个父分段。

          适用于结构清晰的长文档，其中每个章节都能独立提供有意义的上下文。
        </Tab>
        <Tab title="全文">
          整个文档作为单个父分段。

          适用于内容紧凑的小型文档，理解任何具体细节都需要完整的上下文。

          <Note>
            在**全文**模式下：

            - 仅处理前 10,000 个 Token。超出此限制的内容将被截断。

            - 父分段创建后无法编辑。如需修改，必须上传新文档。

          </Note>
        </Tab>
      </Tabs>

      **子分段设置**

      每个父分段会使用其自己的分隔符和分段最大长度设置进一步拆分为子分段。

    </Tab>
</Tabs>

### 快速对比

| 维度 | 通用模式 | 父子模式 |
|:----------|:-------------|:------------------|
| 分段策略 | 单层：所有分段使用相同设置 | 双层：父分段和子分段分别设置 |
| 检索流程 | 匹配的分段直接返回 | 子分段用于匹配查询；父分段被返回以提供更广泛的上下文 |
| 兼容的[索引方式](/zh/use-dify/knowledge/create-knowledge/setting-indexing-methods) | 高质量、经济 | 仅高质量 |
| 最适用于 | 简单、自包含的内容，如术语表或常见问题 | 信息密集的文档，如技术手册或研究论文，上下文很重要 |

## 分段前预处理文本

在将文本拆分为分段之前，你可以清理无关内容以提高检索质量。

- **替换连续的空格、换行符和制表符**

  - 三个或更多连续换行符 → 两个换行符

  - 多个空格 → 单个空格

  - 制表符、换页符和特殊 Unicode 空格 → 普通空格

- **删除所有 URL 和电子邮件地址**

    <Info>
      此设置在**全文**模式下会被忽略。
    </Info>

## 启用摘要自动生成

<Info>仅适用于自托管部署。</Info>

自动为所有分段生成摘要以增强其可检索性。

摘要也会被嵌入和索引以供检索。当摘要匹配查询时，其对应的分段也会被返回。

你可以稍后手动编辑自动生成的摘要或为特定文档重新生成摘要。详情请参阅[管理知识库内容](/zh/use-dify/knowledge/manage-knowledge/maintain-knowledge-documents)。

<Tip>
  如果你选择了具有视觉能力的 LLM，摘要将基于分段文本和任何附加的图片生成。
</Tip>

## 预览分段

点击**预览**查看内容将如何被分段。将显示有限数量的分段供快速查看。

如果结果与你的预期不完全匹配，请选择最接近的配置——你可以稍后手动微调分段。详情请参阅[管理知识库内容](/zh/use-dify/knowledge/manage-knowledge/maintain-knowledge-documents)。

对于多个文档，点击预览面板顶部的文件名可在文档之间切换。