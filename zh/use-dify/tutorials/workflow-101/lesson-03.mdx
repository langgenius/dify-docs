---
title: "第 3 课：Workflow 的大脑（LLM 节点）"
sidebarTitle: 第 3 课
---
<Frame>
  <img src="/images/difyworkflow101-lesson03-llmnode.png" alt="LLM node" />
</Frame>
目标：为“邮件助理”装上大脑，掌握 AI 节点（LLM）的用法，并学会如何测试与调试工作流。

如果说开始节点是准备材料，结束节点是出菜，那么大型语言模型（LLM）节点就是负责烹饪的“主厨”。它是工作流的大脑和核心，负责执行所有思考、分析、创作等智能任务。你想让 AI 总结文章、写代码、回答问题或是创作文案，都是通过这个节点来完成的。

## 配置大型语言模型
我们需要在 LLM 节点选择使用大型语言模型，让我们来快速配置一下。
1. 点击头像，在出现的菜单中点击设置。
<Frame>
  <img src="/images/difyworkflow101-lesson03-llmnode-1.png" alt="Settings" />
</Frame>

2. 在左侧的设置中点击模型供应商，在安装模型供应商里选择 OpenAI，点击安装。
<Frame>
  <img src="/images/difyworkflow101-lesson03-llmnode-2.png" alt="Choose OpenAI" />
</Frame>
<Frame>
  <img src="/images/difyworkflow101-lesson03-install.png" alt="Install OpenAI" />
</Frame>
3. 安装成功，你会在模型列表中看到名为 OpenAI 的大型语言模型。点击右上角 ESC，回到编排窗口。


**看懂大语言模型的能力标签**
正如每位主厨都有自己的拿手菜系，不同的大语言模型也有自己擅长的领域。在 Dify 里选择模型时，你会看到它们身上挂着一些标签，这些标签就是为了告诉我们他擅长什么。

CHAT (聊天): 拥有这个标签的模型，擅长对话、写文章、做总结。我们今天的“邮件助理”工作流就需要带有这个标签的大型语言模型。

1048K (超大记忆力): 这个数字代表模型的“上下文窗口”，可以理解为它的**“短期记忆”有多大**。
K 代表千，1048K 就意味着它能一次性处理大约一百万个词（Token）的超长信息，比如读完一本很厚的书，还能记住开头的情节。包含这个标签的大型语言模型，对于处理长文档、长对话非常有帮助。

**多模态能力 (Multi-modal)**
“模态”指的是信息的类型。多模态就是指模型能处理多种类型的信息，而不仅仅是文字。

VISION (看图识字)  
带有这个标签的模型，不仅能理解文字，还能“看见”图片！你可以给它发送一张图，然后问它“图里包含什么？”。

AUDIO (声音辨识)  
带有这个标签的模型，可以“听懂”音频文件。你可以给它一段录音，让它转写成文字或者总结内容。

VIDEO (视频分析)  
该模型能理解视频内容。

DOCUMENT (文档阅读)  
该模型可以直接阅读和理解你上传的文档，比如 PDF 或者 Word 文件，然后回答相关问题。

了解这些标签，能帮助你在未来为不同的任务，挑选最合适的“主厨”。对于我们今天的“邮件助理”，选择一个基础的 CHAT 模型就足够了。

### 动手实践 1: 添加 LLM 节点
1. 打开刚刚第二课创建的邮件助理工作流。
2. 在开始和结束节点中的空白处，点击右键选择添加节点 - LLM 节点。选中 LLM 节点，在右侧面板的模型内，选择模型 gpt-4o-mini。
<Frame>
  <img src="/images/difyworkflow101-lesson03-addthenode.png" alt="Add the node" />
</Frame>

3. 点击 LLM 节点两侧的加号，分别连接开始和结束节点。
<Frame>
  <img src="/images/difyworkflow101-lesson03-connectthenodes.png" alt="Connect the nodes" />
</Frame>

接下来，我们需要告诉大型语言模型需要做什么。
点击 LLM 节点，在右侧的面板中，找到 System 输入框。在这里，你可以给 AI 输入具体的任务指令（Prompt)。
<Frame>
  <img src="/images/difyworkflow101-lesson03-prompt.png" alt="Add prompt" />
</Frame>


**💡提示词 Prompt **
你可以理解为给 AI 下达的具体任务指令，你告诉 AI “做什么”以及“怎么做”。
最关键的是，你可以在 Prompt 中，使用来自开始节点的变量。这样，AI 就能根据你每次提供的不同“材料”而变化。在 Dify 中，你只需要用 变量名称 这样的格式（我们在第一课动手实践开始节点里的：`customer_name` 和 `email_content`），就可以把变量嵌入到你的指令中。

### 动手实践 2 ：编写 Prompt
现在，我们将一起编写提示词，同时把变量融入其中。  

1. 回到刚才的邮件助理工作流，我们将在在 LLM 节点中的 System 输入框内输入 Prompt，让我们用用简洁明确的方式写出指令。

	你是一名专业的客户服务经理。请根据客户的邮件，草拟一封专业的回复邮件。

	要求：
	1. 首先以友好的语气称呼客户名字
	2. 感谢客户的来信
	3. 告知我们已经收到
	4. 结尾署名“Anne”

2. 找到 `[]`，替换成第二课定义的变量名
	a.选中客户邮件内容这段文字
	b. 在键盘上输入`/`
	c. 在变量选择菜单中，选择 `email_content`
<Frame>
  <img src="/images/difyworkflow101-lesson03-choosevariable.png" alt="Choose variable" />
</Frame>
💡想插入变量的时候，只要按下键盘上的`/`，在弹出的菜单里选中你需要的变量，就能轻松搞定。  

 d. 点击后，你会看到原本的客户邮件内容，已经替换成变量。
<Frame>
  <img src="/images/difyworkflow101-lesson03-promptpreview.png" alt="Prompt preview" />
</Frame>
  e. 用同样的方法，选中客户名字，替换成 `customer_name`
  f. 最终，你的 Prompt 会是
<Frame>
  <img src="/images/CleanShot%202026-01-24%20at%2021.47.57.png" alt="difyworkflow101-lesson03-finalprompt" />
</Frame>

🎉 至此，你已经完成了首个工作流的完整编排。

## 运行与调试
材料备好了，主厨也到位了，指令也写好了，那么工作流的出品如何呢？在正式出菜之前，让我们先“试个菜”。
测试是确保工作流稳定运行的关键一步，它能帮助我们提前发现并解决潜在的问题。

小科普：检查清单（Checklist）
检查清单就像你的私人“体检医生”，它会实时扫描你的工作流，自动找出配置不完整或者明显的错误（比如有节点没有连接好）。

在点击运行前先看一眼这里，能帮你提前了解工作流哪里有不完整的地方。

### 动手实践 3：测试与调试
1. 提前检查  
	看看画布右上角，那个检查清单图标是不是出现了数字 1？ 这意味着，你还有一个地方没有处理好。
<Frame>
  <img src="/images/difyworkflow101-lesson03-checklist.png" alt="Checklist" />
</Frame>

2. 为什么会报错  
	点击它，你会看到一个警告：输出变量不能为空。这意味着输出变量没有收到任何内容。  
	  
	想象一下主厨（LLM 节点）已经把菜做好了，但是服务员（输出节点）没有拿到菜，也根本不知道该把菜端给你。

3. 解决问题  
	a. 点击输出节点  
	b. 在右侧面板的输入变量旁，点解加号 （+）  
	c. 在左侧变量名中，填入 `reply_email`  
	d. 在右侧选择框，选择 LLM 节点下的  `{x} text`。

<Frame>
  <img src="/images/difyworkflow101-lesson03-fixtheissue.png" alt="Fix the issue" />
</Frame>
  
**为什么要选 text? **  
LLM 节点产生的数据有很多（比如消耗了多少 Token，花了多长时间），但 text 才是真正的内容——也就是 AI 写好的那封邮件。 选了 text，就是告诉结束节点：“别管那些技术参数，把正文展示给用户看就行！”

4. 测试运行  
	完成后，你会发现检查清单上的数字消失了，让我们来进行测试运行。点击画布右上角的运行，输入客户名字和客户邮件原文，点击开始运行。
<Frame>
  <img src="/images/difyworkflow101-lesson03-testrun.png" alt="Test run" />
</Frame>
你可以直接使用下方的邮件示例，进行测试

**客户名字**  
Amanda

**客户邮件原文**
Hi there,

I'm writing to ask for more information about Dify. Could you please tell me more on it?

Best regards,
Amanda


5. 运行成功！  
	你会发现，每个节点都运行成功（右侧有绿色的打勾符号），右侧详情处的状态为 SUCCESS。


🎉 恭喜你！你不仅完成了第一个工作流的搭建，并掌握了基础的测试和调试工作流的技巧。

## 小挑战和延展思考
使用工作流，继续完成旅游攻略生成器的搭建。
	提示：探索 Dify 的提示词生成器。
<Frame>
  <img src="/images/difyworkflow101-lesson03-promptgenerator.png" alt="Prompt generator" />
</Frame>
