---
title: 集成阿里云云监控
---

### 什么是阿里云云监控

阿里云提供的全托管免运维可观测平台，一键开启 Dify 应用的监控追踪和评估。

<Info>
  阿里云云监控原生支持 Python/Golang/Java 应用通过 [LoongSuite](https://github.com/alibaba/loongsuite-python-agent) 探针 & 开源 OpenTelemetry 探针接入，在一键开启 Dify 大模型应用监控外，还支持通过无侵入探针对 Dify 组件及其上下游依赖的全链路可观测。
  
  更多详情，请参考 [云监控文档](https://help.aliyun.com/zh/cms/cloudmonitor-2-0/user-guide/model-application)。
</Info>

***

### 如何配置阿里云云监控

#### 1. 获取阿里云 Endpoint 和 License Key

1. 登录 [ARMS 控制台](https://arms.console.aliyun.com/)，在左侧导航栏单击 **接入中心**。
2. 在 **服务端应用** 区域单击 **OpenTelemetry** 卡片。
3. 在弹出的 **OpenTelemetry** 面板中选择数据上报方式为 **gRPC**，并依据实际部署情况选择连接方式和地域。

![获取阿里云接入点](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3938280571/p976945.png)

4. 保存 **公网接入点（Endpoint）** 和 **鉴权 Token（License Key）**。

<Note>
  Endpoint 不带端口号，例如 `http://tracing-cn-heyuan.arms.aliyuncs.com`。
</Note>

#### 2. 在 Dify 中配置云监控

<Info>
  **前提条件**：Dify Cloud 或社区版版本号需 ≥ v1.6.0
</Info>

1. 登录 Dify 控制台，并进入需要监控的应用。
2. 在左侧导航栏打开 **Monitoring**。
3. 单击 **Tracing app performance**，然后在 **云监控** 区域单击 **配置**。

![配置阿里云云监控](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9647222571/p984812.png)

4. 在弹出的对话框中输入步骤 1 获取的 **License Key** 和 **Endpoint**，并自定义 **App Name**（ARMS 控制台显示的应用名称），然后单击 **保存并启用**。

***

### 在阿里云云监控中查看监控数据

配置完成后，Dify 内应用的调试或生产数据可以在云监控中进行监控。

#### 方式一：从 Dify 应用跳转 ARMS 控制台

在 Dify 控制台选择已开启应用追踪的应用，进入 **追踪配置**，在 **云监控** 区域单击 **查看**。

![跳转到 ARMS 控制台](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/9647222571/p984818.png)

#### 方式二：直接在 ARMS 控制台查看

在 ARMS 控制台的 **LLM 应用监控 > 应用列表** 页面进入对应的 Dify 应用。

***

### 接入更多数据

云监控提供了多语言无侵入探针，支持接入 Dify 集群的各个组件，实现全链路追踪。

| Dify 组件      | 探针               | 详情 |
|---------------|--------------------|----------------|
| Nginx         | OpenTelemetry 探针 | [使用 OpenTelemetry 对 Nginx 进行链路追踪](https://help.aliyun.com/zh/opentelemetry/user-guide/use-opentelemetry-to-perform-tracing-analysis-on-nginx)  |
| API           | LoongSuite-Python 探针 | [loongsuite-python-agent](https://github.com/alibaba/loongsuite-python-agent/blob/main/README.md)  |
| Sandbox       | LoongSuite-Go 探针  | [loongsuite-go-agent](https://github.com/alibaba/loongsuite-go-agent/blob/main/README.md)  |
| Worker        | OpenTelemetry 探针 | [通过 OpenTelemetry 上报 Python 应用数据](https://help.aliyun.com/zh/opentelemetry/user-guide/use-managed-service-for-opentelemetry-to-submit-the-trace-data-of-python-applications)  |
| Plugin-Daemon | LoongSuite-Go 探针  | [loongsuite-go-agent](https://github.com/alibaba/loongsuite-go-agent/blob/main/README.md)  |

***

### 监控数据列表

云监控支持采集 Dify 的 Workflow/Chatflow/Chat/Agent 应用，采集数据包括工作流和工作流节点的执行明细，涵盖模型调用、工具调用、知识检索和各类流程节点的执行明细数据以及会话和用户信息等元数据。

#### Workflow/Chatflow Trace 信息

<table>
  <thead>
    <tr>
      <th>Workflow</th>
      <th>阿里云云监控 Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>workflow\_id</td>
      <td>Workflow 的唯一标识</td>
    </tr>
    <tr>
      <td>conversation\_id</td>
      <td>对话 ID</td>
    </tr>
    <tr>
      <td>workflow\_run\_id</td>
      <td>此次运行的 ID</td>
    </tr>
    <tr>
      <td>tenant\_id</td>
      <td>租户 ID</td>
    </tr>
    <tr>
      <td>elapsed\_time</td>
      <td>此次运行耗时</td>
    </tr>
    <tr>
      <td>status</td>
      <td>运行状态</td>
    </tr>
    <tr>
      <td>version</td>
      <td>Workflow 版本</td>
    </tr>
    <tr>
      <td>total\_tokens</td>
      <td>此次运行使用的 token 总数</td>
    </tr>
    <tr>
      <td>file\_list</td>
      <td>处理的文件列表</td>
    </tr>
    <tr>
      <td>triggered\_from</td>
      <td>触发此次运行的来源</td>
    </tr>
    <tr>
      <td>workflow\_run\_inputs</td>
      <td>此次运行的输入数据</td>
    </tr>
    <tr>
      <td>workflow\_run\_outputs</td>
      <td>此次运行的输出数据</td>
    </tr>
    <tr>
      <td>error</td>
      <td>此次运行中发生的错误</td>
    </tr>
    <tr>
      <td>query</td>
      <td>运行时使用的查询</td>
    </tr>
    <tr>
      <td>workflow\_app\_log\_id</td>
      <td>Workflow 应用日志 ID</td>
    </tr>
    <tr>
      <td>message\_id</td>
      <td>关联的消息 ID</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>运行开始时间</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>运行结束时间</td>
    </tr>
  </tbody>
</table>

**Workflow Trace 元数据**

* workflow\_id - Workflow 的唯一标识
* conversation\_id - 对话 ID
* workflow\_run\_id - 此次运行的 ID
* tenant\_id - 租户 ID
* elapsed\_time - 此次运行耗时
* status - 运行状态
* version - Workflow 版本
* total\_tokens - 此次运行使用的 token 总数
* file\_list - 处理的文件列表
* triggered\_from - 触发来源

#### Message Trace 信息

<table>
  <thead>
    <tr>
      <th>Message</th>
      <th>阿里云云监控 Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>message\_id</td>
      <td>消息 ID</td>
    </tr>
    <tr>
      <td>message\_data</td>
      <td>消息数据</td>
    </tr>
    <tr>
      <td>user\_session\_id</td>
      <td>用户的 session\_id</td>
    </tr>
    <tr>
      <td>conversation\_model</td>
      <td>对话模式</td>
    </tr>
    <tr>
      <td>message\_tokens</td>
      <td>消息中的令牌数</td>
    </tr>
    <tr>
      <td>answer\_tokens</td>
      <td>回答中的令牌数</td>
    </tr>
    <tr>
      <td>total\_tokens</td>
      <td>消息和回答中的总令牌数</td>
    </tr>
    <tr>
      <td>error</td>
      <td>错误信息</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>输入数据</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>输出数据</td>
    </tr>
    <tr>
      <td>file\_list</td>
      <td>处理的文件列表</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>开始时间</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>结束时间</td>
    </tr>
    <tr>
      <td>message\_file\_data</td>
      <td>消息关联的文件数据</td>
    </tr>
    <tr>
      <td>conversation\_mode</td>
      <td>对话模式</td>
    </tr>
  </tbody>
</table>

**Message Trace 元数据**

* conversation\_id - 消息所属对话的 ID
* ls\_provider - 模型提供者
* ls\_model\_name - 模型 ID
* status - 消息状态
* from\_end\_user\_id - 发送用户的 ID
* from\_account\_id - 发送账户的 ID
* agent\_based - 是否基于代理
* workflow\_run\_id - 工作流运行 ID
* from\_source - 消息来源
* message\_id - 消息 ID

#### Dataset Retrieval Trace 信息

<table>
  <thead>
    <tr>
      <th>Dataset Retrieval</th>
      <th>阿里云云监控 Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>message\_id</td>
      <td>消息 ID</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>输入内容</td>
    </tr>
    <tr>
      <td>documents</td>
      <td>文档数据</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>开始时间</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>结束时间</td>
    </tr>
    <tr>
      <td>message\_data</td>
      <td>消息数据</td>
    </tr>
  </tbody>
</table>

**Dataset Retrieval Trace 元数据**

* message\_id - 消息 ID
* ls\_provider - 模型提供者
* ls\_model\_name - 模型 ID
* status - 消息状态
* from\_end\_user\_id - 发送用户的 ID
* from\_account\_id - 发送账户的 ID
* agent\_based - 是否基于代理
* workflow\_run\_id - 工作流运行 ID
* from\_source - 消息来源

#### Tool Trace 信息

<table>
  <thead>
    <tr>
      <th>Tool</th>
      <th>阿里云云监控 Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>message\_id</td>
      <td>消息 ID</td>
    </tr>
    <tr>
      <td>tool\_name</td>
      <td>工具名称</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>开始时间</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>结束时间</td>
    </tr>
    <tr>
      <td>tool\_inputs</td>
      <td>工具输入</td>
    </tr>
    <tr>
      <td>tool\_outputs</td>
      <td>工具输出</td>
    </tr>
    <tr>
      <td>message\_data</td>
      <td>消息数据</td>
    </tr>
    <tr>
      <td>error</td>
      <td>错误信息（如果存在）</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>消息的输入内容</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>消息的回答内容</td>
    </tr>
    <tr>
      <td>tool\_config</td>
      <td>工具配置</td>
    </tr>
    <tr>
      <td>time\_cost</td>
      <td>时间成本</td>
    </tr>
    <tr>
      <td>tool\_parameters</td>
      <td>工具参数</td>
    </tr>
    <tr>
      <td>file\_url</td>
      <td>关联文件的 URL</td>
    </tr>
  </tbody>
</table>

**Tool Trace 元数据**

* message\_id - 消息 ID
* tool\_name - 工具名称
* tool\_inputs - 工具输入
* tool\_outputs - 工具输出
* tool\_config - 工具配置
* time\_cost - 时间成本
* error - 错误信息
* tool\_parameters - 工具参数
* message\_file\_id - 消息文件 ID
* created\_by\_role - 创建者角色
* created\_user\_id - 创建者用户 ID

