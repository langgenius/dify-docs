---
title: Dockerの問題
---

<Note> ⚠️ このドキュメントはAIによって自動翻訳されています。不正確な部分がある場合は、[英語版](/en/self-host/troubleshooting/docker-issues)を参照してください。</Note>

## ネットワークと接続

### 502 Bad Gateway

Nginxが間違ったコンテナIPに転送しています。現在のコンテナIPを取得してください：

```bash
docker ps -q | xargs -n 1 docker inspect --format '{{ .Name }}: {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'
```

以下の行を見つけてください：
```
/docker-web-1: 172.19.0.5
/docker-api-1: 172.19.0.7
```

`dify/docker/nginx/conf.d`を更新してください：
- `http://api:5001`を`http://172.19.0.7:5001`に置き換える
- `http://web:3000`を`http://172.19.0.5:3000`に置き換える

nginxを再起動するか、設定を再読み込みしてください。注意：IPはコンテナ再起動時に変更されます。

### localhostサービスにアクセスできない

Dockerコンテナは`127.0.0.1`経由でホストサービスにアクセスできません。代わりにマシンのローカルネットワークIPを使用してください。

例：ホストで動作しているOpenLLMの場合、Difyを`http://192.168.1.100:port`（実際のローカルIP）で設定してください。

### ページが永続的に読み込み中でCORSエラーが発生

ドメイン/URLの変更がクロスオリジンの問題を引き起こします。`docker-compose.yml`で更新してください：

- `CONSOLE_API_URL` - コンソールAPIのバックエンドURL
- `CONSOLE_WEB_URL` - コンソールWebのフロントエンドURL
- `SERVICE_API_URL` - サービスAPIのURL
- `APP_API_URL` - WebAppのAPIバックエンドURL
- `APP_WEB_URL` - WebAppのURL

## マウントとボリューム

### Nginx設定のマウント失敗

エラー：
```
Error mounting "/run/desktop/mnt/host/d/Documents/docker/nginx/nginx.conf" to rootfs at "/etc/nginx/nginx.conf": not a directory
```

完全なプロジェクトをクローンしてdockerディレクトリから実行してください：

```bash
git clone https://github.com/langgenius/dify.git
cd dify/docker
docker compose up -d
```

### ポート競合

ポート80が既に使用中ですか？以下のいずれかを選択してください：

1. 競合するサービス（通常Apache/Nginx）を停止する：
   ```bash
   sudo service nginx stop
   sudo service apache2 stop
   ```

2. または`docker-compose.yaml`でポートマッピングを変更する：
   ```yaml
   ports:
     - "8080:80"  # 異なるポートにマッピング
   ```

## コンテナ管理

### バックグラウンドシェルの出力を表示

実行中のシェルをリスト表示：
```bash
docker exec -it docker-api-1 ls /tmp/shells/
```

シェル出力を確認：
```bash
docker exec -it docker-api-1 cat /tmp/shells/[shell-id]/output.log
```

### コンテナ再起動の問題

システム再起動後、コンテナの接続が失敗する場合があります。適切な起動順序を確保してください：

```bash
docker compose down
docker compose up -d
```

アクセスする前に、すべてのサービスが正常になるまで待機してください。

## SSRFプロキシ

`ssrf_proxy`コンテナはServer-Side Request Forgery攻撃を防止します。

### プロキシルールのカスタマイズ

`docker/volumes/ssrf_proxy/squid.conf`を編集してACLルールを追加してください：

```
# 機密な内部IPへのアクセスをブロック
acl restricted_ip dst 192.168.101.19
acl localnet src 192.168.101.0/24

http_access deny restrictenet
http_access deny all
```

変更後はプロキシコンテナを再起動してください。

### なぜSSRF_PROXYが必要なのか？

サービスが内部ネットワークリソースに対して不正なリクエストを行うことを防ぎます。プロキシはサンドボックス化されたサービスからのすべてのアウトバウンドリクエストを傍受してフィルタリングします。
