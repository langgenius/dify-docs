---
title: 知识检索节点
---

## 简介

知识检索节点可将已有知识库嵌入到 Chatflow 或 Workflow 中。它会在指定知识库中检索与查询相关的信息，然后将检索结果作为上下文传递给下游节点（如 LLM）。

以下是知识检索节点在 Chatflow 中的典型用法：

1. **开始** 节点收集用户问题。
2. **知识检索** 节点在指定知识库中检索与用户问题相关的内容，并输出检索结果。
3. **LLM** 节点基于用户问题和检索结果生成回复。
4. **直接回答** 节点将 LLM 的回复返回给用户。

![知识检索节点用例](/images/knowledge_retrieval_node_example.png)

<Info>
    使用知识检索节点前，确保至少有一个可用的知识库。了解如何创建与管理知识库，阅读 [知识库](/zh-hans/guides/knowledge-base/readme)。
</Info>

## 配置知识检索节点

要让知识检索节点正常工作，你需要告诉它 *检索什么*（查询内容）、*在哪里检索*（知识库），以及 *如何处理检索结果*（节点级检索设置）。你还可以利用文档元数据实现基于筛选的检索，进一步提升精准度。

### 指定查询内容

设置节点需要在选定知识库中检索的查询内容。

- **文本查询**：在 Chatflow 中可用 `userinput.query` 引用用户输入，也可选择任意文本变量。
- **图片查询**：选择图片变量进行图片检索，例如用户通过用户输入节点上传的图片。图片大小限制为 10MB。

    <Info>
        自托管用户可通过环境变量 `UPLOAD_IMAGE_FILE_SIZE_LIMIT`（默认 10）调整图片大小限制。
    </Info>

    <Info>
        仅当至少有一个已添加的知识库支持图片检索时，才可使用 **图片查询**。

        支持图片检索的知识库会显示 **图片** 图标，表示其使用的嵌入模型可对图片进行向量化。
    </Info>


### 选择检索的知识库

为节点添加一个或多个已有知识库，用于检索与查询内容相关的信息。

<Info>
   带有 **图片** 图标的知识库支持图片检索，可用文本和/或图片作为查询，同时检索语义相关的文本和图片。
</Info>

<Tip>
    点击已添加知识库旁的 **编辑** 图标，可直接在知识检索节点内修改其设置。更多设置说明，阅读 [调整知识库设置](/zh-hans/guides/knowledge-base/knowledge-and-documents-maintenance/introduction)和[设定索引方式与检索设置](/zh-hans/guides/knowledge-base/create-knowledge-and-upload-documents/setting-indexing-methods)。
</Tip>


### 调整节点级检索设置

进一步微调节点在获取知识库检索结果后的处理方式。

<Info>
    检索设置分为知识库级和节点级两层。
    
    可理解为两道筛选：知识库设置决定初步的检索结果池，而节点设置再对结果进行重排序或进一步筛选。
</Info>

- **重排序参数**
    - **加权分数**：语义相似度与关键词匹配的权重。语义权重高则更关注语义相关性，关键词权重高则更偏向精确匹配。
        <Info>
            仅当所有已添加的知识库均使用的是高质量索引方式时，才可设置 **加权分数**。
        </Info>
    - **重排序模型**：根据与查询的相关性，对所有结果重新评分和排序。
- **Top K**：重排序后返回的最大结果数。选择重排序模型时，该值会根据模型的最大输入容量自动调整。
- **分数阈值**：返回结果的最低相似度分数。低于阈值的结果会被过滤。阈值高则相关性更严格，阈值低则匹配更宽泛。

<Info>
    添加多个知识库时，会同时检索所有知识库，合并结果并根据上述设置进行处理。
</Info>


### 启用元数据筛选

可利用已有的文档元数据，将检索范围限定在知识库的特定文档内，提升检索精度。

启用元数据筛选后，知识检索节点只会检索符合指定元数据条件的文档，而非整个知识库。尤其适用于内容多样的大型知识库。

<Info>
    了解如何创建与管理文档元数据，请阅读 [元数据](/zh-hans/guides/knowledge-base/metadata)。
</Info>


## 输出结果

知识检索节点会将检索结果输出为 `result` 变量，是一个包含内容、元数据、标题等属性的文档分段数组。

若启用了图片检索且检索到图片，`result` 变量中还会包含名为 `files` 的字段，存储检索到的图片信息。

![知识检索节点输出]()

## 搭配 LLM 节点使用

如需在 LLM 节点中基于检索结果回答用户问题：

1. 在 **上下文** 字段选择知识检索节点的 `result` 变量。
2. 在提示词字段同时引用 `Context` 变量和用户输入变量（如 Chatflow 中的 `userinput.query`）。

![LLM 节点配置示例]()

<Note>
    知识检索操作受订阅计划的频率限制。详见 [知识库请求频率限制](/zh-hans/guides/knowledge-base/knowledge-request-rate-limit)。
</Note>

{/*
Contributing Section
DO NOT edit this section!
It will be automatically generated by the script.
*/}

---

[编辑此页面](https://github.com/langgenius/dify-docs/edit/main/zh-hans/guides/workflow/node/knowledge-retrieval.mdx) | [提交问题](https://github.com/langgenius/dify-docs/issues/new?template=docs.yml)

